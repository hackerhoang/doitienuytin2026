<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªòC PH√ÅT EXCHANGE - ƒê·ªïi Ti·ªÅn An To√†n, Nhanh Ch√≥ng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* ==================== CSS HO√ÄN CH·ªàNH ==================== */
        :root {
            --primary-color: #00a859;
            --secondary-color: #008744;
            --accent-color: #ffcc00;
            --gold-light: #f5e8c8;
            --gold-dark: #8b6914;
            --red-fortune: #ff4444;
            --green-fortune: #00a859;
            --dark-bg: #0a0a0a;
            --dark-card: #1a1a1a;
            --dark-text: #f5f5f5;
            --dark-text-secondary: #d0d0d0;
            --light-bg: #f8fdf6;
            --light-card: #ffffff;
            --light-text: #333333;
            --light-text-secondary: #666666;
            --success-color: #00a859;
            --warning-color: #ff9900;
            --danger-color: #ff4444;
            --blue-invest: #0066cc;
            --border-radius: 15px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.4s ease;
            --gradient-green: linear-gradient(135deg, #00a859, #00cc66, #00a859);
            --gradient-red: linear-gradient(135deg, #ff4444, #ff6666, #ff4444);
            --gradient-blue: linear-gradient(135deg, #0066cc, #0099ff, #0066cc);
            --gradient-gold: linear-gradient(135deg, #ffcc00, #ffdd44, #ffcc00);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.4s ease, color 0.4s ease, transform 0.3s ease;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,5 L55,25 L75,25 L60,35 L65,55 L50,45 L35,55 L40,35 L25,25 L45,25 Z" fill="%2300a859" opacity="0.1"/></svg>');
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,5 L55,25 L75,25 L60,35 L65,55 L50,45 L35,55 L40,35 L25,25 L45,25 Z" fill="%2300a859" opacity="0.05"/></svg>');
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header & Navigation */
        header {
            background: var(--gradient-green);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: 0 5px 20px rgba(0, 168, 89, 0.3);
        }

        body.dark-mode header {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .logo i {
            margin-right: 12px;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            animation: gold-glow 3s infinite alternate;
        }

        @keyframes gold-glow {
            0% { text-shadow: 0 0 5px rgba(255, 204, 0, 0.5); }
            100% { text-shadow: 0 0 15px rgba(255, 204, 0, 0.8), 0 0 20px rgba(255, 204, 0, 0.4); }
        }

        .logo span {
            color: var(--accent-color);
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 25px;
        }

        .nav-links a {
            text-decoration: none;
            color: white;
            font-weight: 600;
            position: relative;
            padding: 8px 0;
            font-size: 16px;
        }

        body.dark-mode .nav-links a {
            color: var(--dark-text);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--accent-color);
            border-radius: 2px;
            transition: width 0.4s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle, .login-btn, .contact-btn {
            background: none;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 18px;
            color: white;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover, .login-btn:hover, .contact-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }

        .user-info {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .user-info {
            background: rgba(0, 0, 0, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin-right: 10px;
            border: 2px solid var(--accent-color);
        }

        .user-name {
            font-weight: 600;
            color: white;
        }

        body.dark-mode .user-name {
            color: var(--dark-text);
        }

        /* Main Content */
        main {
            margin-top: 120px;
            min-height: calc(100vh - 200px);
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        main.fade-out {
            opacity: 0;
            transform: translateY(20px);
        }

        .page {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Home Page */
        .welcome-section {
            background: var(--gradient-green);
            color: white;
            padding: 50px;
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .welcome-section::before {
            content: 'üíµ üí∞ üè¶';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            opacity: 0.3;
        }

        .welcome-section h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .balance-card {
            background: var(--gradient-green);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            border: 3px solid var(--accent-color);
            color: white;
        }

        body.dark-mode .balance-card {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-color: var(--accent-color);
        }

        .balance-card::before {
            content: 'üíé üíµ ü™ô';
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 24px;
            opacity: 0.2;
        }

        .balance-amount {
            font-family: 'Montserrat', sans-serif;
            font-size: 48px;
            font-weight: 800;
            color: var(--accent-color);
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Product Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 35px;
            margin-top: 40px;
        }

        .product-card {
            background-color: var(--light-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid var(--primary-color);
            position: relative;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        body.dark-mode .product-card {
            background-color: var(--dark-card);
            border-color: var(--primary-color);
        }

        .product-card:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 168, 89, 0.3);
            animation-play-state: paused;
        }

        .product-card.special {
            border: 3px solid var(--accent-color);
            animation: float 4s ease-in-out infinite;
        }

        .product-card.special::before {
            content: '‚ö° T√ôY CH·ªàNH';
            position: absolute;
            top: 15px;
            right: -30px;
            background: var(--gradient-gold);
            color: var(--primary-color);
            padding: 5px 35px;
            font-size: 12px;
            font-weight: 700;
            transform: rotate(45deg);
            box-shadow: 0 3px 10px rgba(255, 204, 0, 0.5);
            z-index: 1;
        }

        .product-img {
            height: 200px;
            background: linear-gradient(135deg, #e8f7ef, #fff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            color: var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .product-img::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        body.dark-mode .product-img {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
        }

        .product-info {
            padding: 25px;
        }

        .product-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-color);
        }

        .product-price {
            color: var(--red-fortune);
            font-weight: 800;
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .product-return {
            color: var(--green-fortune);
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .product-price::before {
            content: 'üíµ ';
            margin-right: 8px;
        }

        .product-return::before {
            content: 'üí∞ ';
            margin-right: 8px;
        }

        .exchange-rate {
            background: rgba(0, 168, 89, 0.1);
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px dashed var(--primary-color);
        }

        .exchange-rate span {
            color: var(--red-fortune);
            font-weight: 800;
        }

        .investment-slider-container {
            margin: 20px 0;
        }

        .investment-slider {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #ddd, var(--primary-color));
            border-radius: 5px;
            outline: none;
            margin: 15px 0;
        }

        .investment-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--red-fortune);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            transition: var(--transition);
        }

        .investment-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }

        .investment-amount {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .investment-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            transition: var(--transition);
        }

        .investment-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255, 204, 0, 0.3);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            transform: translateX(-100%);
        }

        .btn:hover::after {
            animation: btn-shine 0.8s;
        }

        @keyframes btn-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .btn-primary {
            background: var(--gradient-green);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 168, 89, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 168, 89, 0.6);
        }

        .btn-order {
            background: var(--gradient-gold);
            color: var(--primary-color);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }

        .btn-order:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 204, 0, 0.6);
        }

        .btn-block {
            width: 100%;
        }

        /* Product Policies */
        .product-policies {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .policy-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 168, 89, 0.05);
            transition: var(--transition);
        }

        .policy-item:hover {
            background: rgba(0, 168, 89, 0.1);
            transform: translateX(5px);
        }

        .policy-icon {
            width: 30px;
            height: 30px;
            background: var(--gradient-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .policy-content h4 {
            font-size: 14px;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-weight: 700;
        }

        .policy-content p {
            font-size: 12px;
            color: var(--light-text-secondary);
            line-height: 1.4;
        }

        body.dark-mode .policy-content p {
            color: var(--dark-text-secondary);
        }

        /* Product Detail Page */
        .product-detail {
            display: flex;
            flex-wrap: wrap;
            gap: 50px;
            margin-top: 30px;
        }

        .product-image-large {
            flex: 1;
            min-width: 300px;
            height: 450px;
            background: linear-gradient(135deg, #e8f7ef, #fff);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 140px;
            color: var(--primary-color);
            box-shadow: var(--box-shadow);
            border: 5px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .product-image-large::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        body.dark-mode .product-image-large {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-color: var(--primary-color);
        }

        .product-details {
            flex: 1;
            min-width: 300px;
        }

        .product-details h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            margin-bottom: 20px;
            color: var(--primary-color);
            position: relative;
            display: inline-block;
        }

        .product-details h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-green);
            border-radius: 2px;
        }

        .product-description {
            margin-bottom: 35px;
            color: var(--light-text-secondary);
            line-height: 1.8;
            font-size: 17px;
        }

        body.dark-mode .product-description {
            color: var(--dark-text-secondary);
        }

        .price-tag {
            font-family: 'Montserrat', sans-serif;
            font-size: 48px;
            font-weight: 800;
            color: var(--red-fortune);
            margin-bottom: 40px;
            display: flex;
            align-items: center;
        }

        .price-tag::before {
            content: 'üí∞ ';
            margin-right: 15px;
            font-size: 40px;
        }

        /* Payment Page */
        .payment-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .payment-card {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--box-shadow);
            margin-bottom: 40px;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .payment-card {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
            border-color: var(--primary-color);
        }

        .payment-card::before {
            content: 'üí≥ ‚ö†Ô∏è üîí';
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-size: 24px;
            opacity: 0.1;
        }

        .bank-info {
            background: linear-gradient(135deg, rgba(0, 168, 89, 0.1), rgba(255, 204, 0, 0.1));
            border-left: 6px solid var(--primary-color);
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            position: relative;
        }

        .bank-info::before {
            content: 'üè¶';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            opacity: 0.3;
        }

        .bank-details {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        body.dark-mode .bank-details {
            background: rgba(0, 0, 0, 0.3);
        }

        .bank-details p {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .bank-details p {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .bank-details span:first-child {
            font-weight: 700;
            color: var(--primary-color);
        }

        .bank-details span:last-child {
            font-weight: 700;
            color: var(--red-fortune);
            font-family: monospace;
            font-size: 16px;
        }

        .status-pending {
            color: var(--warning-color);
            font-weight: 800;
            background: rgba(255, 153, 0, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
            display: inline-block;
        }

        .status-completed {
            color: var(--success-color);
            font-weight: 800;
            background: rgba(0, 168, 89, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
            display: inline-block;
        }

        /* Payment Warning */
        .payment-warning {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(255, 204, 0, 0.1));
            border: 3px solid var(--red-fortune);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .payment-warning::before {
            content: '‚ö†Ô∏è ‚ö†Ô∏è ‚ö†Ô∏è';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            opacity: 0.3;
        }

        .warning-title {
            color: var(--red-fortune);
            font-weight: 800;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-title::before {
            content: '‚ùó';
            font-size: 24px;
        }

        .warning-list {
            padding-left: 25px;
            margin: 15px 0;
        }

        .warning-list li {
            margin-bottom: 10px;
            padding-left: 10px;
        }

        /* Account Settings Page */
        .account-settings {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            margin-top: 30px;
        }

        .account-sidebar {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            border: 2px solid var(--primary-color);
        }

        body.dark-mode .account-sidebar {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
            border-color: var(--primary-color);
        }

        .account-menu {
            list-style: none;
        }

        .account-menu li {
            margin-bottom: 15px;
        }

        .account-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            text-decoration: none;
            color: var(--light-text);
            border-radius: 10px;
            transition: var(--transition);
            font-weight: 500;
        }

        body.dark-mode .account-menu a {
            color: var(--dark-text);
        }

        .account-menu a.active, .account-menu a:hover {
            background: var(--gradient-green);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 168, 89, 0.3);
        }

        .account-content {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--box-shadow);
            border: 2px solid var(--primary-color);
        }

        body.dark-mode .account-content {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
            border-color: var(--primary-color);
        }

        .history-section {
            display: none;
        }

        .history-section.active {
            display: block;
        }

        /* Purchase History */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        body.dark-mode .history-table {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
        }

        .history-table th, .history-table td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .history-table th,
        body.dark-mode .history-table td {
            border-bottom: 1px solid #333;
        }

        .history-table th {
            background: var(--gradient-green);
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        body.dark-mode .history-table th {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            color: var(--dark-text);
        }

        /* Admin Page */
        .admin-section {
            margin-top: 30px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--gradient-green);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            text-align: center;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
            color: white;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
        }

        .stat-card:nth-child(2) {
            background: var(--gradient-red);
        }

        .stat-card:nth-child(3) {
            background: var(--gradient-blue);
        }

        .stat-card h3 {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .stat-value {
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            font-weight: 800;
            color: white;
        }

        .orders-list {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 35px;
            box-shadow: var(--box-shadow);
            border: 3px solid var(--primary-color);
        }

        body.dark-mode .orders-list {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
            border-color: var(--primary-color);
        }

        .order-item {
            padding: 25px;
            border-bottom: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
            border-radius: 10px;
            transition: var(--transition);
        }

        body.dark-mode .order-item {
            border-bottom: 2px solid #333;
            background: rgba(0, 0, 0, 0.3);
        }

        .order-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .order-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .order-actions button {
            margin-left: 15px;
        }

        /* Contact Page */
        .contact-section {
            margin-top: 50px;
            text-align: center;
        }

        .contact-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .contact-card {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            padding: 25px 40px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 20px;
            text-decoration: none;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
            transition: var(--transition);
        }

        .contact-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 30px rgba(37, 211, 102, 0.5);
        }

        .contact-card.telegram {
            background: linear-gradient(135deg, #0088cc, #005580);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.3);
        }

        .contact-card.telegram:hover {
            box-shadow: 0 15px 30px rgba(0, 136, 204, 0.5);
        }

        /* Login Section */
        .login-section {
            max-width: 500px;
            margin: 50px auto;
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 50px;
            box-shadow: var(--box-shadow);
            border: 3px solid var(--primary-color);
            text-align: center;
        }

        body.dark-mode .login-section {
            background: linear-gradient(135deg, var(--dark-card), #2a2a2a);
            border-color: var(--primary-color);
        }

        .login-section h2 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 32px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.8);
            transition: var(--transition);
        }

        body.dark-mode .form-group input {
            background: rgba(0, 0, 0, 0.3);
            border-color: var(--primary-color);
            color: var(--dark-text);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255, 204, 0, 0.3);
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--dark-bg), #000);
            color: var(--dark-text);
            padding: 40px 0;
            margin-top: 80px;
            text-align: center;
            border-top: 5px solid var(--primary-color);
        }

        .footer-logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .copyright {
            color: var(--accent-color);
            margin-top: 25px;
            opacity: 0.8;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.4s ease;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 50px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.5s ease;
            border: 5px solid var(--primary-color);
            position: relative;
        }

        body.dark-mode .modal-content {
            background: linear-gradient(135deg, var(--dark-card), #1a1a1a);
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal h2 {
            margin-bottom: 25px;
            color: var(--red-fortune);
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 40px;
        }

        /* Logout Button */
        .logout-btn {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            margin-top: 20px;
            width: 100%;
            justify-content: center;
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 68, 68, 0.4);
        }

        /* Loader */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-green);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 9998;
            box-shadow: var(--box-shadow);
            transform: translateX(400px);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--gradient-green);
        }

        .notification.error {
            background: var(--gradient-red);
        }

        .notification.warning {
            background: var(--gradient-gold);
            color: var(--primary-color);
        }

        /* Admin Dashboard */
        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .admin-search {
            flex: 1;
            min-width: 300px;
        }

        .user-list {
            background: linear-gradient(135deg, var(--light-card), #fff);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            border: 2px solid var(--primary-color);
            margin-top: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .user-item:hover {
            background: rgba(0, 168, 89, 0.05);
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-info-admin {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-admin {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .user-details h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .user-details p {
            color: var(--light-text-secondary);
            font-size: 14px;
        }

        body.dark-mode .user-details p {
            color: var(--dark-text-secondary);
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.admin {
            background: var(--gradient-red);
            color: white;
        }

        .badge.user {
            background: var(--gradient-green);
            color: white;
        }

        .badge.vip {
            background: var(--gradient-gold);
            color: var(--primary-color);
        }

        /* Deposit/Withdraw Modals */
        .modal-input-group {
            margin: 20px 0;
        }

        .modal-input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-input-group input,
        .modal-input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-size: 16px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .nav-links {
                display: none;
            }
            
            .product-detail {
                flex-direction: column;
            }
            
            .contact-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .contact-card {
                width: 100%;
                max-width: 400px;
            }
            
            .account-settings {
                grid-template-columns: 1fr;
            }
            
            .admin-controls {
                flex-direction: column;
            }
            
            .admin-search {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .welcome-section h1 {
                font-size: 28px;
            }
            
            .balance-amount {
                font-size: 36px;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .history-table {
                display: block;
                overflow-x: auto;
            }
            
            .order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .order-actions {
                display: flex;
                gap: 10px;
            }
            
            .order-actions button {
                margin-left: 0;
            }
            
            .user-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i class="fas fa-exchange-alt"></i>
                    L·ªòC PH√ÅT <span>EXCHANGE</span>
                </div>
                <ul class="nav-links">
                    <li><a href="#" data-page="home">Trang ch·ªß</a></li>
                    <li><a href="#" data-page="products">ƒê·ªïi ti·ªÅn ngay</a></li>
                    <li><a href="#" data-page="account">T√†i kho·∫£n</a></li>
                    <li><a href="#" data-page="admin">Qu·∫£n l√Ω</a></li>
                    <li><a href="#" data-page="contact">Li√™n h·ªá</a></li>
                </ul>
                <div class="nav-controls">
                    <button class="contact-btn" title="Li√™n h·ªá" onclick="navigateTo('contact')">
                        <i class="fas fa-headset"></i>
                    </button>
                    <button class="theme-toggle" id="themeToggle" title="Chuy·ªÉn ƒë·ªïi giao di·ªán">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="login-btn" id="loginBtn" title="ƒêƒÉng nh·∫≠p">
                        <i class="fas fa-user"></i>
                    </button>
                    <div class="user-info" id="userInfo" style="display: none;">
                        <div class="user-avatar" id="userAvatar">ND</div>
                        <div>
                            <div class="user-name" id="userName">Nguy·ªÖn ƒê·ª©c</div>
                            <div class="user-balance">S·ªë d∆∞: <span id="headerBalance">0ƒë</span></div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main id="mainContent">
        <!-- Home Page -->
        <section class="page active" id="home">
            <div class="container">
                <div class="welcome-section">
                    <h1>ƒê·ªîI TI·ªÄN T·ª∂ L·ªÜ 1:3 üìà</h1>
                    <p>G·ª≠i ti·ªÅn m·ªôt l·∫ßn - Nh·∫≠n g·∫•p 3 l·∫ßn ch·ªâ sau 24h</p>
                </div>
                
                <div class="balance-card">
                    <h2>üí∞ S·ªê D∆Ø KH·∫¢ D·ª§NG</h2>
                    <div class="balance-amount" id="balanceAmount">0ƒë</div>
                    <p id="balanceMessage">ƒêƒÉng nh·∫≠p ƒë·ªÉ xem s·ªë d∆∞</p>
                    <div id="homeButtons" style="display: none;">
                        <button class="btn btn-order" onclick="navigateTo('products')" style="margin-top: 20px; margin-right: 15px;">
                            <i class="fas fa-exchange-alt"></i> ƒê·ªîI TI·ªÄN NGAY
                        </button>
                        <button class="btn btn-primary" onclick="navigateTo('account')">
                            <i class="fas fa-money-bill-wave"></i> N·∫†P TI·ªÄN
                        </button>
                    </div>
                    <div id="loginPrompt" style="margin-top: 20px;">
                        <p>ƒê·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª•, vui l√≤ng ƒëƒÉng nh·∫≠p ho·∫∑c ƒëƒÉng k√Ω t√†i kho·∫£n</p>
                        <button class="btn btn-primary" onclick="navigateTo('loginPage')" style="margin-top: 10px;">
                            <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù
                        </button>
                    </div>
                </div>
                
                <h2 style="color: var(--primary-color); font-size: 28px; text-align: center; margin: 30px 0;">
                    üèÜ G√ìI ƒê·ªîI TI·ªÄN N·ªîI B·∫¨T
                </h2>
                <div class="products-grid" id="homeProducts">
                    <!-- Products will be loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Products Page -->
        <section class="page" id="products">
            <div class="container">
                <h1 style="color: var(--primary-color); font-size: 36px; text-align: center; margin-bottom: 30px;">
                    üíµ ƒê·ªîI TI·ªÄN NGAY
                </h1>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Account Settings Page -->
        <section class="page" id="account">
            <div class="container">
                <h1 style="color: var(--primary-color); text-align: center; margin-bottom: 30px;">
                    ‚öôÔ∏è C√ÄI ƒê·∫∂T T√ÄI KHO·∫¢N
                </h1>
                <div id="accountLoginPrompt" style="text-align: center; padding: 50px;">
                    <i class="fas fa-user-lock" style="font-size: 80px; color: var(--primary-color); margin-bottom: 20px;"></i>
                    <h3>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p trang t√†i kho·∫£n</h3>
                    <button class="btn btn-primary" onclick="navigateTo('loginPage')" style="margin-top: 20px;">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P NGAY
                    </button>
                </div>
                <div class="account-settings" id="accountContent" style="display: none;">
                    <div class="account-sidebar">
                        <ul class="account-menu">
                            <li><a href="#" class="active" onclick="showAccountSection('history')">
                                <i class="fas fa-history"></i> L·ªãch s·ª≠ giao d·ªãch
                            </a></li>
                            <li><a href="#" onclick="showAccountSection('pending')">
                                <i class="fas fa-clock"></i> ƒêang ch·ªù x√°c nh·∫≠n
                            </a></li>
                            <li><a href="#" onclick="showAccountSection('completed')">
                                <i class="fas fa-check-circle"></i> ƒê√£ x√°c nh·∫≠n
                            </a></li>
                            <li><a href="#" onclick="showAccountSection('profile')">
                                <i class="fas fa-user-cog"></i> Th√¥ng tin c√° nh√¢n
                            </a></li>
                            <li><a href="#" onclick="showAccountSection('deposit')">
                                <i class="fas fa-money-bill-wave"></i> N·∫°p ti·ªÅn
                            </a></li>
                            <li><a href="#" onclick="showAccountSection('withdraw')">
                                <i class="fas fa-wallet"></i> R√∫t ti·ªÅn
                            </a></li>
                        </ul>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> ƒêƒÇNG XU·∫§T
                        </button>
                    </div>
                    
                    <div class="account-content">
                        <!-- Purchase History Section -->
                        <div class="history-section active" id="historySection">
                            <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-history"></i> L·ªäCH S·ª¨ GIAO D·ªäCH
                            </h2>
                            <div id="noHistoryMessage" style="text-align: center; padding: 40px; color: var(--light-text-secondary);">
                                <i class="fas fa-history" style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;"></i>
                                <h3>Ch∆∞a c√≥ giao d·ªãch n√†o</h3>
                                <p>B·∫Øt ƒë·∫ßu giao d·ªãch ƒë·∫ßu ti√™n c·ªßa b·∫°n ngay!</p>
                            </div>
                            <table class="history-table" id="accountHistoryTable" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>M√£ giao d·ªãch</th>
                                        <th>Lo·∫°i</th>
                                        <th>S·ªë ti·ªÅn</th>
                                        <th>Ng√†y</th>
                                        <th>Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody id="accountHistoryBody">
                                    <!-- Account history will be loaded here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pending Orders Section -->
                        <div class="history-section" id="pendingSection">
                            <h2 style="color: var(--warning-color); margin-bottom: 20px;">
                                <i class="fas fa-clock"></i> ƒêANG CH·ªú X√ÅC NH·∫¨N
                            </h2>
                            <div id="noPendingMessage" style="text-align: center; padding: 40px; color: var(--light-text-secondary);">
                                <i class="fas fa-clock" style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;"></i>
                                <h3>Kh√¥ng c√≥ giao d·ªãch ch·ªù x√°c nh·∫≠n</h3>
                            </div>
                            <table class="history-table" id="accountPendingTable" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>M√£ giao d·ªãch</th>
                                        <th>Lo·∫°i</th>
                                        <th>S·ªë ti·ªÅn</th>
                                        <th>Ng√†y</th>
                                        <th>Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody id="accountPendingBody">
                                    <!-- Pending orders will be loaded here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Completed Orders Section -->
                        <div class="history-section" id="completedSection">
                            <h2 style="color: var(--success-color); margin-bottom: 20px;">
                                <i class="fas fa-check-circle"></i> ƒê√É X√ÅC NH·∫¨N
                            </h2>
                            <div id="noCompletedMessage" style="text-align: center; padding: 40px; color: var(--light-text-secondary);">
                                <i class="fas fa-check-circle" style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;"></i>
                                <h3>Ch∆∞a c√≥ giao d·ªãch ho√†n th√†nh</h3>
                            </div>
                            <table class="history-table" id="accountCompletedTable" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>M√£ giao d·ªãch</th>
                                        <th>Lo·∫°i</th>
                                        <th>S·ªë ti·ªÅn</th>
                                        <th>S·ªë ti·ªÅn nh·∫≠n</th>
                                        <th>Ng√†y ho√†n th√†nh</th>
                                    </tr>
                                </thead>
                                <tbody id="accountCompletedBody">
                                    <!-- Completed orders will be loaded here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Profile Section -->
                        <div class="history-section" id="profileSection">
                            <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-user-cog"></i> TH√îNG TIN C√Å NH√ÇN
                            </h2>
                            <div style="background: rgba(0, 168, 89, 0.1); padding: 25px; border-radius: var(--border-radius);">
                                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                                    <div class="user-avatar" id="profileAvatar" style="width: 80px; height: 80px; font-size: 32px;">ND</div>
                                    <div>
                                        <h3 style="color: var(--primary-color);" id="profileName">Nguy·ªÖn ƒê·ª©c</h3>
                                        <p id="profileEmail">ƒêang t·∫£i...</p>
                                        <p id="profileJoinDate">Th√†nh vi√™n t·ª´: ƒêang t·∫£i...</p>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                    <div>
                                        <p><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> <span id="profileUsername">...</span></p>
                                        <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="profilePhone">Ch∆∞a c·∫≠p nh·∫≠t</span></p>
                                    </div>
                                    <div>
                                        <p><strong>T·ªïng giao d·ªãch:</strong> <span id="totalTransactions">0</span></p>
                                        <p><strong>T·ªïng l·ª£i nhu·∫≠n:</strong> <span id="totalProfit">0ƒë</span></p>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="showEditProfile()" style="margin-top: 20px;">
                                    <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a th√¥ng tin
                                </button>
                            </div>
                        </div>
                        
                        <!-- Deposit Section -->
                        <div class="history-section" id="depositSection">
                            <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-money-bill-wave"></i> N·∫†P TI·ªÄN V√ÄO T√ÄI KHO·∫¢N
                            </h2>
                            <div class="payment-card">
                                <div class="bank-info">
                                    <h3><i class="fas fa-university"></i> TH√îNG TIN N·∫†P TI·ªÄN</h3>
                                    <p>Chuy·ªÉn kho·∫£n v√†o t√†i kho·∫£n sau ƒë·ªÉ n·∫°p ti·ªÅn:</p>
                                    <div class="bank-details">
                                        <p><span>Ng√¢n h√†ng:</span> <span>VIETCOMBANK</span></p>
                                        <p><span>S·ªë t√†i kho·∫£n:</span> <span>1234567890</span></p>
                                        <p><span>Ch·ªß t√†i kho·∫£n:</span> <span>NGUY·ªÑN VƒÇN L·ªòC</span></p>
                                        <p><span>S·ªë ti·ªÅn:</span> <span>T√πy ch·ªçn</span></p>
                                        <p><span>N·ªôi dung:</span> <span id="depositContent">NAP<id ng∆∞·ªùi d√πng></span></p>
                                    </div>
                                </div>
                                
                                <div style="margin: 30px 0;">
                                    <label for="depositAmount" style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px; display: block;">
                                        S·ªë ti·ªÅn mu·ªën n·∫°p (t·ªëi thi·ªÉu 100,000ƒë):
                                    </label>
                                    <input type="number" 
                                           id="depositAmount" 
                                           class="investment-input" 
                                           min="100000" 
                                           max="1000000000" 
                                           placeholder="Nh·∫≠p s·ªë ti·ªÅn">
                                </div>
                                
                                <p style="color: var(--warning-color); margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i> Sau khi chuy·ªÉn kho·∫£n, s·ªë d∆∞ s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong v√≤ng 15-30 ph√∫t.
                                </p>
                                
                                <button class="btn btn-primary btn-block" onclick="confirmDeposit()">
                                    <i class="fas fa-check-circle"></i> X√ÅC NH·∫¨N ƒê√É CHUY·ªÇN KHO·∫¢N
                                </button>
                            </div>
                        </div>
                        
                        <!-- Withdraw Section -->
                        <div class="history-section" id="withdrawSection">
                            <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-wallet"></i> R√öT TI·ªÄN V·ªÄ T√ÄI KHO·∫¢N
                            </h2>
                            <div class="payment-card">
                                <div style="margin-bottom: 30px;">
                                    <p><strong>S·ªë d∆∞ kh·∫£ d·ª•ng:</strong> <span id="withdrawBalance" style="color: var(--green-fortune); font-weight: 800; font-size: 24px;">0ƒë</span></p>
                                    <p><strong>S·ªë ti·ªÅn t·ªëi thi·ªÉu r√∫t:</strong> 200,000ƒë</p>
                                </div>
                                
                                <div style="margin: 30px 0;">
                                    <label for="withdrawAmount" style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px; display: block;">
                                        S·ªë ti·ªÅn mu·ªën r√∫t:
                                    </label>
                                    <input type="number" 
                                           id="withdrawAmount" 
                                           class="investment-input" 
                                           min="200000" 
                                           placeholder="Nh·∫≠p s·ªë ti·ªÅn">
                                </div>
                                
                                <div style="margin: 30px 0;">
                                    <label for="withdrawBank" style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px; display: block;">
                                        Th√¥ng tin ng√¢n h√†ng nh·∫≠n ti·ªÅn:
                                    </label>
                                    <input type="text" 
                                           id="withdrawBankName" 
                                           class="investment-input" 
                                           placeholder="T√™n ng√¢n h√†ng" 
                                           style="margin-bottom: 15px;">
                                    <input type="text" 
                                           id="withdrawAccountNumber" 
                                           class="investment-input" 
                                           placeholder="S·ªë t√†i kho·∫£n" 
                                           style="margin-bottom: 15px;">
                                    <input type="text" 
                                           id="withdrawAccountName" 
                                           class="investment-input" 
                                           placeholder="T√™n ch·ªß t√†i kho·∫£n">
                                </div>
                                
                                <p style="color: var(--warning-color); margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i> Y√™u c·∫ßu r√∫t ti·ªÅn s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω trong v√≤ng 2-4 gi·ªù l√†m vi·ªác.
                                </p>
                                
                                <button class="btn btn-primary btn-block" onclick="confirmWithdraw()">
                                    <i class="fas fa-paper-plane"></i> G·ª¨I Y√äU C·∫¶U R√öT TI·ªÄN
                                </button>
                            </div>
                        </div>
                        
                        <!-- Edit Profile Section (hidden by default) -->
                        <div class="history-section" id="editProfileSection" style="display: none;">
                            <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-edit"></i> CH·ªàNH S·ª¨A TH√îNG TIN
                            </h2>
                            <div style="background: rgba(0, 168, 89, 0.1); padding: 30px; border-radius: var(--border-radius);">
                                <div class="form-group">
                                    <label for="editName"><i class="fas fa-user"></i> H·ªç v√† t√™n</label>
                                    <input type="text" id="editName" class="investment-input" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                                </div>
                                <div class="form-group">
                                    <label for="editPhone"><i class="fas fa-phone"></i> S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" id="editPhone" class="investment-input" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                                </div>
                                <div class="form-group">
                                    <label for="editPassword"><i class="fas fa-lock"></i> M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)</label>
                                    <input type="password" id="editPassword" class="investment-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                                </div>
                                <div class="form-group">
                                    <label for="editConfirmPassword"><i class="fas fa-lock"></i> X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" id="editConfirmPassword" class="investment-input" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                                </div>
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button class="btn" onclick="cancelEditProfile()">
                                        <i class="fas fa-times"></i> H·ªßy
                                    </button>
                                    <button class="btn btn-primary" onclick="saveProfile()">
                                        <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Detail Page -->
        <section class="page" id="productDetail">
            <div class="container">
                <button class="btn btn-order" onclick="navigateTo('products')" style="margin-bottom: 30px;">
                    <i class="fas fa-arrow-left"></i> Quay l·∫°i danh s√°ch
                </button>
                <div id="productDetailLoginPrompt" style="text-align: center; padding: 50px;">
                    <i class="fas fa-lock" style="font-size: 80px; color: var(--primary-color); margin-bottom: 20px;"></i>
                    <h3>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem chi ti·∫øt s·∫£n ph·∫©m</h3>
                    <button class="btn btn-primary" onclick="navigateTo('loginPage')" style="margin-top: 20px;">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P NGAY
                    </button>
                </div>
                <div class="product-detail" id="productDetailContent" style="display: none;">
                    <!-- Product details will be loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Payment Page -->
        <section class="page" id="payment">
            <div class="container">
                <div class="payment-container">
                    <h1 style="color: var(--red-fortune); text-align: center; margin-bottom: 30px;">
                        üí≥ THANH TO√ÅN ƒê·ªîI TI·ªÄN
                    </h1>
                    <div id="paymentLoginPrompt" style="text-align: center; padding: 50px;">
                        <i class="fas fa-shopping-cart" style="font-size: 80px; color: var(--primary-color); margin-bottom: 20px;"></i>
                        <h3>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n</h3>
                        <button class="btn btn-primary" onclick="navigateTo('loginPage')" style="margin-top: 20px;">
                            <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P NGAY
                        </button>
                    </div>
                    <div id="paymentContent" style="display: none;">
                        <div class="payment-card">
                            <h2 id="paymentProductName" style="color: var(--primary-color);">G√≥i ƒë·ªïi ti·ªÅn c∆° b·∫£n</h2>
                            <p>S·ªë ti·ªÅn g·ª≠i: <strong id="paymentQuantity">500.000ƒë</strong></p>
                            <p>S·ªë ti·ªÅn nh·∫≠n: <strong id="paymentReturn" style="color: var(--green-fortune);">1.500.000ƒë</strong></p>
                            <p>T·ª∑ l·ªá ƒë·ªïi: <strong style="color: var(--green-fortune);">1:3</strong></p>
                            
                            <div class="bank-info">
                                <h3><i class="fas fa-university"></i> TH√îNG TIN CHUY·ªÇN KHO·∫¢N</h3>
                                <p>Vui l√≤ng chuy·ªÉn kho·∫£n ƒë·∫øn t√†i kho·∫£n sau:</p>
                                <div class="bank-details">
                                    <p><span>Ng√¢n h√†ng:</span> <span>VIETCOMBANK</span></p>
                                    <p><span>S·ªë t√†i kho·∫£n:</span> <span>1234567890</span></p>
                                    <p><span>Ch·ªß t√†i kho·∫£n:</span> <span>NGUY·ªÑN VƒÇN L·ªòC</span></p>
                                    <p><span>S·ªë ti·ªÅn:</span> <span id="bankAmount">500.000ƒë</span></p>
                                    <p><span>N·ªôi dung:</span> <span id="bankContent">DOITIENGOICOBAN</span></p>
                                </div>
                            </div>
                            
                            <p style="margin: 20px 0;">Sau khi chuy·ªÉn kho·∫£n, giao d·ªãch s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω trong v√≤ng <strong>15-30 ph√∫t</strong>.</p>
                            <p>Tr·∫°ng th√°i: <span class="status-pending" id="paymentStatus">ƒêang ch·ªù thanh to√°n</span></p>
                            
                            <button class="btn btn-primary btn-block" onclick="confirmPayment()" style="margin-top: 30px;">
                                <i class="fas fa-check-circle"></i> T√îI ƒê√É CHUY·ªÇN KHO·∫¢N
                            </button>
                        </div>

                        <!-- Payment Warning -->
                        <div class="payment-warning">
                            <div class="warning-title">L∆ØU √ù QUAN TR·ªåNG KHI THANH TO√ÅN</div>
                            <ul class="warning-list">
                                <li>‚ùå <strong>H·∫°n ch·∫ø thanh to√°n</strong> nh∆∞ h√≥a ƒë∆°n ƒëi·ªán n∆∞·ªõc v√† chuy·ªÉn v√†o c√°c t√†i kho·∫£n c√¥ng ty t√†i ch√≠nh ho·∫∑c ch·ª©ng kho√°n USDT</li>
                                <li>‚ö†Ô∏è <strong>M·ªói s·ªë t√†i kho·∫£n</strong> ch·ªâ t·ªëi ƒëa 3 l·∫ßn nh·∫≠n trong 1 tu·∫ßn</li>
                                <li>üö´ <strong>B·∫°n ph·∫£i ch·ªãu ho√†n to√†n tr√°ch nhi·ªám</strong> n·∫øu s·ª≠ d·ª•ng sai m·ª•c ƒë√≠ch</li>
                                <li>‚úÖ ∆Øu ti√™n chuy·ªÉn kho·∫£n t·ª´ t√†i kho·∫£n c√° nh√¢n c√πng ng√¢n h√†ng ƒë·ªÉ x·ª≠ l√Ω nhanh nh·∫•t</li>
                                <li>‚è∞ Th·ªùi gian x√°c nh·∫≠n c√≥ th·ªÉ l√¢u h∆°n n·∫øu chuy·ªÉn kho·∫£n kh√°c ng√¢n h√†ng</li>
                            </ul>
                            <p style="color: var(--red-fortune); font-weight: 700; margin-top: 15px;">
                                <i class="fas fa-exclamation-triangle"></i> Vui l√≤ng tu√¢n th·ªß ƒë√∫ng h∆∞·ªõng d·∫´n ƒë·ªÉ giao d·ªãch ƒë∆∞·ª£c x·ª≠ l√Ω nhanh ch√≥ng!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Page -->
        <section class="page" id="contact">
            <div class="container">
                <div class="welcome-section" style="background: linear-gradient(135deg, #25D366, #128C7E);">
                    <h1>üìû LI√äN H·ªÜ H·ªñ TR·ª¢</h1>
                    <p>ƒê·ªôi ng≈© h·ªó tr·ª£ 24/7 s·∫µn s√†ng gi·∫£i ƒë√°p m·ªçi th·∫Øc m·∫Øc</p>
                </div>
                
                <div class="contact-section">
                    <h2 style="color: var(--primary-color); margin-bottom: 20px;">K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i qua</h2>
                    <div class="contact-buttons">
                        <a href="https://zalo.me/0901234567" target="_blank" class="contact-card">
                            <i class="fab fa-zalo" style="font-size: 32px;"></i>
                            <div>
                                <div>Zalo h·ªó tr·ª£</div>
                                <div style="font-size: 14px; opacity: 0.9;">0901 234 567</div>
                            </div>
                        </a>
                        <a href="https://t.me/locphatexchange" target="_blank" class="contact-card telegram">
                            <i class="fab fa-telegram" style="font-size: 32px;"></i>
                            <div>
                                <div>Telegram Group</div>
                                <div style="font-size: 14px; opacity: 0.9;">@locphatexchange</div>
                            </div>
                        </a>
                    </div>
                    
                    <div style="margin-top: 50px; background: rgba(0, 168, 89, 0.1); padding: 25px; border-radius: var(--border-radius);">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">üè¢ Th√¥ng tin li√™n h·ªá</h3>
                        <p><strong>ƒê·ªãa ch·ªâ:</strong> 168 Ph·ªë T√†i L·ªôc, Qu·∫≠n 1, TP.HCM</p>
                        <p><strong>Hotline:</strong> 1900 8888 - <strong>Email:</strong> support@locphatexchange.vn</p>
                        <p><strong>Th·ªùi gian l√†m vi·ªác:</strong> 8:00 - 22:00 h√†ng ng√†y</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section class="page" id="admin">
            <div class="container">
                <h1 style="color: var(--primary-color); text-align: center; margin-bottom: 30px;">
                    üëë TRANG QU·∫¢N L√ù H·ªÜ TH·ªêNG
                </h1>
                <div id="adminLoginPrompt" style="text-align: center; padding: 50px;">
                    <i class="fas fa-shield-alt" style="font-size: 80px; color: var(--primary-color); margin-bottom: 20px;"></i>
                    <h3>Ch·ªâ d√†nh cho Qu·∫£n tr·ªã vi√™n</h3>
                    <p>Vui l√≤ng ƒëƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n admin</p>
                    <button class="btn btn-primary" onclick="navigateTo('loginPage')" style="margin-top: 20px;">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P
                    </button>
                </div>
                <div id="adminContent" style="display: none;">
                    <div class="admin-stats">
                        <div class="stat-card">
                            <h3>T·ªïng ng∆∞·ªùi d√πng</h3>
                            <div class="stat-value" id="totalUsers">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>T·ªïng ti·ªÅn g·ª≠i</h3>
                            <div class="stat-value" id="totalDeposits">0ƒë</div>
                        </div>
                        <div class="stat-card">
                            <h3>Giao d·ªãch ch·ªù</h3>
                            <div class="stat-value" id="pendingTransactions">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Doanh thu ng√†y</h3>
                            <div class="stat-value" id="dailyRevenue">0ƒë</div>
                        </div>
                    </div>
                    
                    <div class="admin-controls">
                        <div class="admin-search">
                            <input type="text" 
                                   id="adminSearch" 
                                   class="investment-input" 
                                   placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng theo email ho·∫∑c t√™n..."
                                   onkeyup="searchUsers()">
                        </div>
                        <button class="btn btn-primary" onclick="refreshAdminData()">
                            <i class="fas fa-sync-alt"></i> L√†m m·ªõi
                        </button>
                        <button class="btn btn-order" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i> Th√™m ng∆∞·ªùi d√πng
                        </button>
                        <button class="btn" style="background: var(--gradient-red); color: white;" onclick="showSystemConfig()">
                            <i class="fas fa-cog"></i> C·∫•u h√¨nh h·ªá th·ªëng
                        </button>
                    </div>
                    
                    <div class="orders-list">
                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">üë• DANH S√ÅCH NG∆Ø·ªúI D√ôNG</h2>
                        <div id="usersList">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="orders-list" style="margin-top: 30px;">
                        <h2 style="color: var(--primary-color); margin-bottom: 25px;">üìä GIAO D·ªäCH C·∫¶N X·ª¨ L√ù</h2>
                        <div id="adminTransactionsList">
                            <!-- Transactions will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Page -->
        <section class="page" id="loginPage">
            <div class="container">
                <div class="login-section">
                    <div id="authContainer">
                        <!-- Login/Register forms will be loaded here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-logo">
                <i class="fas fa-exchange-alt"></i>
                L·ªòC PH√ÅT EXCHANGE
            </div>
            <p>ƒê·ªãa ch·ªâ: 168 Ph·ªë T√†i L·ªôc, Qu·∫≠n 1, TP.HCM</p>
            <p>Hotline: 1900 8888 - Email: support@locphatexchange.vn</p>
            <div class="copyright">
                &copy; 2023 L·ªôc Ph√°t Exchange. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.<br>
                "ƒê·ªïi ti·ªÅn an to√†n - Nh·∫≠n ngay l·ª£i nhu·∫≠n"
            </div>
        </div>
    </footer>

    <!-- Payment Confirmation Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h2>‚úÖ X√ÅC NH·∫¨N THANH TO√ÅN</h2>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn ƒë√£ chuy·ªÉn kho·∫£n th√†nh c√¥ng?</p>
            <p>Sau khi x√°c nh·∫≠n, giao d·ªãch s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω trong v√≤ng 15-30 ph√∫t.</p>
            <p style="color: var(--red-fortune); font-weight: 700; margin-top: 20px;">
                <i class="fas fa-exclamation-triangle"></i> L∆∞u √Ω: Vui l√≤ng ch·ªâ x√°c nh·∫≠n khi ƒë√£ th·ª±c s·ª± chuy·ªÉn kho·∫£n!
            </p>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal()">H·ªßy b·ªè</button>
                <button class="btn btn-primary" onclick="processPayment()">X√°c nh·∫≠n thanh to√°n</button>
            </div>
        </div>
    </div>

    <!-- Deposit Confirmation Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2>üí∞ X√ÅC NH·∫¨N N·∫†P TI·ªÄN</h2>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn ƒë√£ chuy·ªÉn kho·∫£n <span id="depositModalAmount">0ƒë</span>?</p>
            <p>Sau khi x√°c nh·∫≠n, y√™u c·∫ßu n·∫°p ti·ªÅn s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn qu·∫£n tr·ªã vi√™n.</p>
            <div class="modal-actions">
                <button class="btn" onclick="closeDepositModal()">H·ªßy b·ªè</button>
                <button class="btn btn-primary" onclick="processDeposit()">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <!-- Withdraw Confirmation Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h2>üí≥ X√ÅC NH·∫¨N R√öT TI·ªÄN</h2>
            <p>B·∫°n mu·ªën r√∫t <span id="withdrawModalAmount">0ƒë</span> v·ªÅ t√†i kho·∫£n?</p>
            <p><strong>Ng√¢n h√†ng:</strong> <span id="withdrawModalBank"></span></p>
            <p><strong>S·ªë t√†i kho·∫£n:</strong> <span id="withdrawModalAccount"></span></p>
            <p><strong>Ch·ªß t√†i kho·∫£n:</strong> <span id="withdrawModalName"></span></p>
            <div class="modal-actions">
                <button class="btn" onclick="closeWithdrawModal()">H·ªßy b·ªè</button>
                <button class="btn btn-primary" onclick="processWithdraw()">X√°c nh·∫≠n r√∫t ti·ªÅn</button>
            </div>
        </div>
    </div>

    <!-- Admin Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <h2>üë§ TH√äM NG∆Ø·ªúI D√ôNG M·ªöI</h2>
            <div class="modal-input-group">
                <label for="newUserName"><i class="fas fa-user"></i> H·ªç v√† t√™n</label>
                <input type="text" id="newUserName" class="investment-input" placeholder="Nh·∫≠p h·ªç v√† t√™n">
            </div>
            <div class="modal-input-group">
                <label for="newUserEmail"><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="newUserEmail" class="investment-input" placeholder="Nh·∫≠p email">
            </div>
            <div class="modal-input-group">
                <label for="newUserPassword"><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                <input type="password" id="newUserPassword" class="investment-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
            </div>
            <div class="modal-input-group">
                <label for="newUserRole"><i class="fas fa-user-tag"></i> Vai tr√≤</label>
                <select id="newUserRole" class="investment-input">
                    <option value="user">Ng∆∞·ªùi d√πng</option>
                    <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                    <option value="vip">VIP</option>
                </select>
            </div>
            <div class="modal-input-group">
                <label for="newUserBalance"><i class="fas fa-money-bill-wave"></i> S·ªë d∆∞ ban ƒë·∫ßu</label>
                <input type="number" id="newUserBalance" class="investment-input" value="0" min="0">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeAddUserModal()">H·ªßy</button>
                <button class="btn btn-primary" onclick="createNewUser()">T·∫°o ng∆∞·ªùi d√πng</button>
            </div>
        </div>
    </div>

    <!-- Admin Edit User Modal -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <h2>‚úèÔ∏è CH·ªàNH S·ª¨A NG∆Ø·ªúI D√ôNG</h2>
            <input type="hidden" id="editUserId">
            <div class="modal-input-group">
                <label for="editUserName"><i class="fas fa-user"></i> H·ªç v√† t√™n</label>
                <input type="text" id="editUserName" class="investment-input">
            </div>
            <div class="modal-input-group">
                <label for="editUserEmail"><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="editUserEmail" class="investment-input" disabled>
            </div>
            <div class="modal-input-group">
                <label for="editUserPhone"><i class="fas fa-phone"></i> S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="text" id="editUserPhone" class="investment-input">
            </div>
            <div class="modal-input-group">
                <label for="editUserBalance"><i class="fas fa-money-bill-wave"></i> S·ªë d∆∞</label>
                <input type="number" id="editUserBalance" class="investment-input" min="0">
            </div>
            <div class="modal-input-group">
                <label for="editUserRole"><i class="fas fa-user-tag"></i> Vai tr√≤</label>
                <select id="editUserRole" class="investment-input">
                    <option value="user">Ng∆∞·ªùi d√πng</option>
                    <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                    <option value="vip">VIP</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeEditUserModal()">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveUserChanges()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <!-- Admin System Config Modal -->
    <div class="modal" id="systemConfigModal">
        <div class="modal-content">
            <h2>‚öôÔ∏è C·∫§U H√åNH H·ªÜ TH·ªêNG</h2>
            <div class="modal-input-group">
                <label for="configExchangeRate"><i class="fas fa-percentage"></i> T·ª∑ l·ªá ƒë·ªïi ti·ªÅn (1:X)</label>
                <input type="number" id="configExchangeRate" class="investment-input" value="3" min="1" max="10">
            </div>
            <div class="modal-input-group">
                <label for="configMinDeposit"><i class="fas fa-money-bill-wave"></i> S·ªë ti·ªÅn n·∫°p t·ªëi thi·ªÉu</label>
                <input type="number" id="configMinDeposit" class="investment-input" value="100000" min="10000">
            </div>
            <div class="modal-input-group">
                <label for="configMinWithdraw"><i class="fas fa-wallet"></i> S·ªë ti·ªÅn r√∫t t·ªëi thi·ªÉu</label>
                <input type="number" id="configMinWithdraw" class="investment-input" value="200000" min="50000">
            </div>
            <div class="modal-input-group">
                <label for="configProcessingTime"><i class="fas fa-clock"></i> Th·ªùi gian x·ª≠ l√Ω (ph√∫t)</label>
                <input type="number" id="configProcessingTime" class="investment-input" value="30" min="5" max="120">
            </div>
            <div class="modal-input-group">
                <label for="configMaxTransactions"><i class="fas fa-exchange-alt"></i> S·ªë giao d·ªãch t·ªëi ƒëa/tu·∫ßn</label>
                <input type="number" id="configMaxTransactions" class="investment-input" value="3" min="1" max="10">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeSystemConfigModal()">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveSystemConfig()">L∆∞u c·∫•u h√¨nh</button>
            </div>
        </div>
    </div>

    <!-- Admin Process Transaction Modal -->
    <div class="modal" id="processTransactionModal">
        <div class="modal-content">
            <h2>üîÑ X·ª¨ L√ù GIAO D·ªäCH</h2>
            <input type="hidden" id="processTransactionId">
            <input type="hidden" id="processUserId">
            <input type="hidden" id="processTransactionType">
            
            <p><strong>M√£ giao d·ªãch:</strong> <span id="processTransactionCode"></span></p>
            <p><strong>Ng∆∞·ªùi d√πng:</strong> <span id="processUserName"></span></p>
            <p><strong>Lo·∫°i:</strong> <span id="processType"></span></p>
            <p><strong>S·ªë ti·ªÅn:</strong> <span id="processAmount"></span></p>
            <p><strong>Ng√†y t·∫°o:</strong> <span id="processDate"></span></p>
            
            <div class="modal-input-group" id="processReturnAmountGroup" style="display: none;">
                <label for="processReturnAmount"><i class="fas fa-money-bill-wave"></i> S·ªë ti·ªÅn tr·∫£ cho kh√°ch (t·ª± ƒë·ªông x3)</label>
                <input type="number" id="processReturnAmount" class="investment-input" readonly>
            </div>
            
            <div class="modal-input-group">
                <label for="processStatus"><i class="fas fa-check-circle"></i> Tr·∫°ng th√°i</label>
                <select id="processStatus" class="investment-input">
                    <option value="pending">ƒêang ch·ªù</option>
                    <option value="processing">ƒêang x·ª≠ l√Ω</option>
                    <option value="completed">Ho√†n th√†nh</option>
                    <option value="cancelled">ƒê√£ h·ªßy</option>
                </select>
            </div>
            
            <div class="modal-input-group">
                <label for="processNotes"><i class="fas fa-sticky-note"></i> Ghi ch√∫</label>
                <textarea id="processNotes" class="investment-input" rows="3" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
            </div>
            
            <div class="modal-actions">
                <button class="btn" onclick="closeProcessTransactionModal()">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveTransactionProcess()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        // THAY TH·∫æ B·∫∞NG C·∫§U H√åNH C·ª¶A B·∫†N T·ª™ FIREBASE CONSOLE
        const firebaseConfig = {
            apiKey: "AIzaSyCw8iVqK2eXqV7J8K9LmN1oP2QrS3tUvWxYz",
            authDomain: "locphat-exchange.firebaseapp.com",
            projectId: "locphat-exchange",
            storageBucket: "locphat-exchange.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // Kh·ªüi t·∫°o Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let currentUserData = null;
        let currentProduct = null;
        let currentOrderId = null;
        let isDarkMode = false;
        let products = [];
        let systemConfig = {
            exchangeRate: 3,
            minDeposit: 100000,
            minWithdraw: 200000,
            processingTime: 30,
            maxTransactionsPerWeek: 3
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            checkAuthState();
            loadProducts();
            loadSystemConfig();
        });

        function initApp() {
            setupEventListeners();
            loadAuthForms();
        }

        // ==================== AUTHENTICATION FUNCTIONS ====================
        function checkAuthState() {
            showLoader();
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    // Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p
                    await loadUserData(user.uid);
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        isLoggedIn: true
                    };
                    updateUIForLoggedInUser();
                    hideLoader();
                    
                    // Ki·ªÉm tra n·∫øu l√† admin
                    if (currentUserData && currentUserData.role === 'admin') {
                        if (window.location.hash === '#admin' || document.querySelector('.page.active').id === 'admin') {
                            loadAdminData();
                        }
                    }
                } else {
                    // Ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p
                    currentUser = null;
                    currentUserData = null;
                    updateUIForLoggedOutUser();
                    hideLoader();
                    if (window.location.hash !== '#contact' && window.location.hash !== '#loginPage') {
                        navigateTo('home');
                    }
                }
            });
        }

        async function loadUserData(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    currentUserData = doc.data();
                    updateUserProfileUI();
                } else {
                    // T·∫°o d·ªØ li·ªáu ng∆∞·ªùi d√πng m·ªõi n·∫øu ch∆∞a c√≥
                    await createUserData(uid);
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('L·ªói t·∫£i d·ªØ li·ªáu ng∆∞·ªùi d√πng', 'error');
            }
        }

        async function createUserData(uid) {
            const user = auth.currentUser;
            const userData = {
                uid: uid,
                email: user.email,
                username: user.email.split('@')[0],
                fullName: user.displayName || user.email.split('@')[0],
                phone: '',
                balance: 0,
                avatar: getInitials(user.displayName || user.email.split('@')[0]),
                joinDate: new Date().toLocaleDateString('vi-VN'),
                transactions: [],
                totalDeposit: 0,
                totalWithdraw: 0,
                role: 'user',
                isActive: true,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('users').doc(uid).set(userData);
                currentUserData = userData;
                updateUserProfileUI();
            } catch (error) {
                console.error('Error creating user data:', error);
                showNotification('L·ªói t·∫°o d·ªØ li·ªáu ng∆∞·ªùi d√πng', 'error');
            }
        }

        function getInitials(name) {
            const names = name.split(' ');
            if (names.length >= 2) {
                return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        // ==================== LOGIN/REGISTER FUNCTIONS ====================
        function loadAuthForms() {
            const container = document.getElementById('authContainer');
            container.innerHTML = `
                <h2>üîê ƒêƒÇNG NH·∫¨P</h2>
                <div class="form-group">
                    <label for="loginEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" placeholder="Nh·∫≠p email c·ªßa b·∫°n">
                </div>
                <div class="form-group">
                    <label for="loginPassword"><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                    <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <button class="btn btn-primary" onclick="login()" style="width: 100%; padding: 18px;">
                    <i class="fas fa-sign-in-alt"></i> ƒêƒÇNG NH·∫¨P
                </button>
                <div style="margin-top: 15px; text-align: center;">
                    <a href="#" onclick="showForgotPassword()" style="color: var(--primary-color); font-size: 14px;">Qu√™n m·∫≠t kh·∫©u?</a>
                </div>
                <p style="margin-top: 20px; color: var(--light-text-secondary);">
                    Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="showRegisterForm()" style="color: var(--primary-color); font-weight: 600;">ƒêƒÉng k√Ω ngay</a>
                </p>
            `;
        }

        function showRegisterForm() {
            const container = document.getElementById('authContainer');
            container.innerHTML = `
                <h2>üìù ƒêƒÇNG K√ù T√ÄI KHO·∫¢N</h2>
                <div class="form-group">
                    <label for="registerName"><i class="fas fa-user"></i> H·ªç v√† t√™n</label>
                    <input type="text" id="registerName" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                </div>
                <div class="form-group">
                    <label for="registerEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="registerEmail" placeholder="Nh·∫≠p email">
                </div>
                <div class="form-group">
                    <label for="registerPhone"><i class="fas fa-phone"></i> S·ªë ƒëi·ªán tho·∫°i (t√πy ch·ªçn)</label>
                    <input type="tel" id="registerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                </div>
                <div class="form-group">
                    <label for="registerPassword"><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                    <input type="password" id="registerPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)">
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword"><i class="fas fa-lock"></i> X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                    <input type="password" id="registerConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
                </div>
                <div class="form-group">
                    <label style="font-size: 14px;">
                        <input type="checkbox" id="registerTerms"> T√¥i ƒë·ªìng √Ω v·ªõi <a href="#" style="color: var(--primary-color);">ƒëi·ªÅu kho·∫£n d·ªãch v·ª•</a>
                    </label>
                </div>
                <button class="btn btn-primary" onclick="register()" style="width: 100%; padding: 18px;">
                    <i class="fas fa-user-plus"></i> ƒêƒÇNG K√ù
                </button>
                <p style="margin-top: 20px; color: var(--light-text-secondary);">
                    ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="loadAuthForms()" style="color: var(--primary-color); font-weight: 600;">ƒêƒÉng nh·∫≠p ngay</a>
                </p>
            `;
        }

        function showForgotPassword() {
            const container = document.getElementById('authContainer');
            container.innerHTML = `
                <h2>üîì QU√äN M·∫¨T KH·∫®U</h2>
                <div class="form-group">
                    <label for="forgotEmail"><i class="fas fa-envelope"></i> Email ƒëƒÉng k√Ω</label>
                    <input type="email" id="forgotEmail" placeholder="Nh·∫≠p email c·ªßa b·∫°n">
                </div>
                <button class="btn btn-primary" onclick="sendPasswordReset()" style="width: 100%; padding: 18px;">
                    <i class="fas fa-paper-plane"></i> G·ª¨I LINK ƒê·∫∂T L·∫†I M·∫¨T KH·∫®U
                </button>
                <p style="margin-top: 20px; color: var(--light-text-secondary);">
                    <a href="#" onclick="loadAuthForms()" style="color: var(--primary-color); font-weight: 600;">‚Üê Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
                </p>
            `;
        }

        async function sendPasswordReset() {
            const email = document.getElementById('forgotEmail').value;
            
            if (!email) {
                showNotification('Vui l√≤ng nh·∫≠p email!', 'warning');
                return;
            }

            showLoader();
            try {
                await auth.sendPasswordResetEmail(email);
                showNotification('ƒê√£ g·ª≠i link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë·∫øn email c·ªßa b·∫°n!', 'success');
                loadAuthForms();
                hideLoader();
            } catch (error) {
                hideLoader();
                handleAuthError(error);
            }
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const terms = document.getElementById('registerTerms').checked;

            if (!name || !email || !password || !confirmPassword) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'warning');
                return;
            }

            if (!terms) {
                showNotification('Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n d·ªãch v·ª•!', 'warning');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!', 'warning');
                return;
            }

            if (password.length < 6) {
                showNotification('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!', 'warning');
                return;
            }

            showLoader();
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // C·∫≠p nh·∫≠t display name
                await user.updateProfile({
                    displayName: name
                });

                // T·∫°o d·ªØ li·ªáu ng∆∞·ªùi d√πng trong Firestore
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    username: user.email.split('@')[0],
                    fullName: name,
                    phone: phone || '',
                    balance: 0,
                    avatar: getInitials(name),
                    joinDate: new Date().toLocaleDateString('vi-VN'),
                    transactions: [],
                    totalDeposit: 0,
                    totalWithdraw: 0,
                    role: 'user',
                    isActive: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(user.uid).set(userData);
                
                showNotification('ƒêƒÉng k√Ω th√†nh c√¥ng!', 'success');
                hideLoader();
            } catch (error) {
                hideLoader();
                handleAuthError(error);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'warning');
                return;
            }

            showLoader();
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                hideLoader();
            } catch (error) {
                hideLoader();
                handleAuthError(error);
            }
        }

        async function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                showLoader();
                try {
                    await auth.signOut();
                    showNotification('ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!', 'success');
                    hideLoader();
                } catch (error) {
                    hideLoader();
                    showNotification('L·ªói ƒëƒÉng xu·∫•t: ' + error.message, 'error');
                }
            }
        }

        // ==================== USER PROFILE FUNCTIONS ====================
        function updateUserProfileUI() {
            if (!currentUserData) return;

            // C·∫≠p nh·∫≠t header
            document.getElementById('userName').textContent = currentUserData.fullName || currentUserData.username;
            document.getElementById('userAvatar').textContent = currentUserData.avatar;
            document.getElementById('headerBalance').textContent = formatCurrency(currentUserData.balance || 0) + 'ƒë';
            document.getElementById('balanceAmount').textContent = formatCurrency(currentUserData.balance || 0) + 'ƒë';
            
            // C·∫≠p nh·∫≠t trang home
            if (currentUserData.balance > 0) {
                document.getElementById('balanceMessage').textContent = 'S·∫µn s√†ng ƒë·ªïi ti·ªÅn v√† nh·∫≠n l·ª£i nhu·∫≠n si√™u kh·ªßng!';
                document.getElementById('homeButtons').style.display = 'block';
                document.getElementById('loginPrompt').style.display = 'none';
            } else {
                document.getElementById('balanceMessage').textContent = 'S·ªë d∆∞ c·ªßa b·∫°n ƒëang l√† 0ƒë. H√£y n·∫°p ti·ªÅn ƒë·ªÉ b·∫Øt ƒë·∫ßu!';
                document.getElementById('homeButtons').style.display = 'block';
                document.getElementById('loginPrompt').style.display = 'none';
            }

            // C·∫≠p nh·∫≠t trang account
            document.getElementById('accountLoginPrompt').style.display = 'none';
            document.getElementById('accountContent').style.display = 'grid';
            
            // C·∫≠p nh·∫≠t trang profile
            document.getElementById('profileName').textContent = currentUserData.fullName || currentUserData.username;
            document.getElementById('profileAvatar').textContent = currentUserData.avatar;
            document.getElementById('profileEmail').textContent = currentUserData.email;
            document.getElementById('profileUsername').textContent = currentUserData.username;
            document.getElementById('profileJoinDate').textContent = 'Th√†nh vi√™n t·ª´: ' + (currentUserData.joinDate || 'ƒêang t·∫£i...');
            document.getElementById('profilePhone').textContent = currentUserData.phone || 'Ch∆∞a c·∫≠p nh·∫≠t';
            document.getElementById('withdrawBalance').textContent = formatCurrency(currentUserData.balance || 0) + 'ƒë';

            // T√≠nh to√°n th·ªëng k√™
            const transactions = currentUserData.transactions || [];
            const exchangeTransactions = transactions.filter(t => t.type === 'exchange' && t.status === 'completed');
            const totalProfit = exchangeTransactions.reduce((sum, t) => sum + (t.returnAmount || 0), 0);
            
            document.getElementById('totalTransactions').textContent = transactions.length;
            document.getElementById('totalProfit').textContent = formatCurrency(totalProfit) + 'ƒë';

            // C·∫≠p nh·∫≠t n·ªôi dung chuy·ªÉn kho·∫£n n·∫°p ti·ªÅn
            document.getElementById('depositContent').textContent = `NAP${currentUserData.uid.substring(0, 8).toUpperCase()}`;

            // T·∫£i l·ªãch s·ª≠ giao d·ªãch
            loadUserTransactions();
        }

        function showEditProfile() {
            document.getElementById('profileSection').style.display = 'none';
            document.getElementById('editProfileSection').style.display = 'block';
            
            document.getElementById('editName').value = currentUserData.fullName || '';
            document.getElementById('editPhone').value = currentUserData.phone || '';
            document.getElementById('editPassword').value = '';
            document.getElementById('editConfirmPassword').value = '';
        }

        function cancelEditProfile() {
            document.getElementById('editProfileSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'block';
        }

        async function saveProfile() {
            const name = document.getElementById('editName').value;
            const phone = document.getElementById('editPhone').value;
            const password = document.getElementById('editPassword').value;
            const confirmPassword = document.getElementById('editConfirmPassword').value;

            if (!name) {
                showNotification('Vui l√≤ng nh·∫≠p h·ªç v√† t√™n!', 'warning');
                return;
            }

            if (password && password.length < 6) {
                showNotification('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!', 'warning');
                return;
            }

            if (password && password !== confirmPassword) {
                showNotification('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!', 'warning');
                return;
            }

            showLoader();
            try {
                // C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng trong Firestore
                const updates = {
                    fullName: name,
                    phone: phone,
                    avatar: getInitials(name),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(currentUser.uid).update(updates);

                // C·∫≠p nh·∫≠t display name trong Firebase Auth
                await auth.currentUser.updateProfile({
                    displayName: name
                });

                // C·∫≠p nh·∫≠t m·∫≠t kh·∫©u n·∫øu c√≥
                if (password) {
                    await auth.currentUser.updatePassword(password);
                }

                // T·∫£i l·∫°i d·ªØ li·ªáu ng∆∞·ªùi d√πng
                await loadUserData(currentUser.uid);
                
                showNotification('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!', 'success');
                cancelEditProfile();
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói c·∫≠p nh·∫≠t: ' + error.message, 'error');
            }
        }

        // ==================== PRODUCT FUNCTIONS ====================
        function loadProducts() {
            products = [
                { 
                    id: 1, 
                    name: "G√ìI C∆† B·∫¢N", 
                    price: 500000, 
                    returnAmount: 1500000,
                    icon: "fa-money-bill-wave",
                    description: "G·ª≠i 500,000ƒë nh·∫≠n ngay 1,500,000ƒë sau 24h. T·ª∑ l·ªá ƒë·ªïi 1:3."
                },
                { 
                    id: 2, 
                    name: "G√ìI B·∫†C", 
                    price: 1000000, 
                    returnAmount: 3000000,
                    icon: "fa-money-bill-wave",
                    description: "G·ª≠i 1,000,000ƒë nh·∫≠n ngay 3,000,000ƒë sau 24h. T·ª∑ l·ªá ƒë·ªïi 1:3."
                },
                { 
                    id: 3, 
                    name: "G√ìI V√ÄNG", 
                    price: 5000000, 
                    returnAmount: 15000000,
                    icon: "fa-money-bill-wave",
                    description: "G·ª≠i 5,000,000ƒë nh·∫≠n ngay 15,000,000ƒë sau 24h. T·ª∑ l·ªá ƒë·ªïi 1:3."
                },
                { 
                    id: 4, 
                    name: "G√ìI KIM C∆Ø∆†NG", 
                    price: 10000000, 
                    returnAmount: 30000000,
                    icon: "fa-gem",
                    description: "G·ª≠i 10,000,000ƒë nh·∫≠n ngay 30,000,000ƒë sau 24h. T·ª∑ l·ªá ƒë·ªïi 1:3."
                },
                { 
                    id: 5, 
                    name: "G√ìI T√ôY CH·ªàNH", 
                    price: 500000, 
                    returnAmount: 1500000,
                    icon: "fa-sliders-h",
                    description: "T·ª± ch·ªçn s·ªë ti·ªÅn g·ª≠i t·ª´ 500,000ƒë ƒë·∫øn 500,000,000ƒë. Nh·∫≠n g·∫•p 3 l·∫ßn sau 24h.",
                    isCustom: true,
                    minAmount: 500000,
                    maxAmount: 500000000
                }
            ];

            renderProducts('homeProducts');
            renderProducts('productsGrid');
        }

        function renderProducts(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = `product-card ${product.isCustom ? 'special' : ''}`;
                
                if (product.isCustom) {
                    productCard.innerHTML = `
                        <div class="product-img">
                            <i class="fas ${product.icon}"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">G·ª≠i: T·ª´ ${formatCurrency(product.minAmount)}ƒë ƒë·∫øn ${formatCurrency(product.maxAmount)}ƒë</div>
                            <div class="product-return">Nh·∫≠n: G·∫•p ${systemConfig.exchangeRate} l·∫ßn sau 24h</div>
                            
                            <div class="exchange-rate">
                                T·ª∑ l·ªá ƒë·ªïi: <span>1 : ${systemConfig.exchangeRate}</span>
                            </div>
                            
                            <div class="investment-slider-container">
                                <div class="investment-amount">
                                    <span>S·ªë ti·ªÅn g·ª≠i:</span>
                                    <span id="customAmountDisplay${product.id}">${formatCurrency(product.price)}ƒë</span>
                                </div>
                                <input type="range" 
                                       class="investment-slider" 
                                       min="${product.minAmount}" 
                                       max="${product.maxAmount}" 
                                       step="100000" 
                                       value="${product.price}"
                                       oninput="updateCustomExchange(${product.id}, this.value)">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <input type="number" 
                                       class="investment-input" 
                                       id="customInput${product.id}" 
                                       min="${product.minAmount}" 
                                       max="${product.maxAmount}"
                                       value="${product.price}"
                                       oninput="updateCustomExchangeFromInput(${product.id}, this.value)"
                                       placeholder="Nh·∫≠p s·ªë ti·ªÅn g·ª≠i">
                            </div>
                            
                            <div style="margin-bottom: 20px; color: var(--green-fortune); font-weight: 700; text-align: center;">
                                S·∫Ω nh·∫≠n ƒë∆∞·ª£c: <span id="customReturnDisplay${product.id}">${formatCurrency(product.returnAmount)}ƒë</span>
                            </div>
                            
                            <button class="btn btn-order btn-block" onclick="viewProductDetail(${product.id})">
                                <i class="fas fa-exchange-alt"></i> ORDER NOW
                            </button>
                            
                            <div class="product-policies">
                                <div class="policy-item">
                                    <div class="policy-icon">
                                        <i class="fas fa-money-check-alt"></i>
                                    </div>
                                    <div class="policy-content">
                                        <h4>Ch√≠nh s√°ch thanh to√°n</h4>
                                        <p>Thanh to√°n ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung. X√°c nh·∫≠n trong ${systemConfig.processingTime} ph√∫t.</p>
                                    </div>
                                </div>
                                <div class="policy-item">
                                    <div class="policy-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="policy-content">
                                        <h4>Ch√≠nh s√°ch b·∫£o m·∫≠t</h4>
                                        <p>B·∫£o m·∫≠t th√¥ng tin kh√°ch h√†ng tuy·ªát ƒë·ªëi.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    productCard.innerHTML = `
                        <div class="product-img">
                            <i class="fas ${product.icon}"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">G·ª≠i: ${formatCurrency(product.price)}ƒë</div>
                            <div class="product-return">Nh·∫≠n: ${formatCurrency(product.returnAmount)}ƒë</div>
                            
                            <div class="exchange-rate">
                                T·ª∑ l·ªá ƒë·ªïi: <span>1 : ${systemConfig.exchangeRate}</span>
                            </div>
                            
                            <button class="btn btn-order btn-block" onclick="viewProductDetail(${product.id})">
                                <i class="fas fa-exchange-alt"></i> ORDER NOW
                            </button>
                            
                            <div class="product-policies">
                                <div class="policy-item">
                                    <div class="policy-icon">
                                        <i class="fas fa-money-check-alt"></i>
                                    </div>
                                    <div class="policy-content">
                                        <h4>Ch√≠nh s√°ch thanh to√°n</h4>
                                        <p>Thanh to√°n ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung. X√°c nh·∫≠n trong ${systemConfig.processingTime} ph√∫t.</p>
                                    </div>
                                </div>
                                <div class="policy-item">
                                    <div class="policy-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="policy-content">
                                        <h4>Ch√≠nh s√°ch b·∫£o m·∫≠t</h4>
                                        <p>B·∫£o m·∫≠t th√¥ng tin kh√°ch h√†ng tuy·ªát ƒë·ªëi.</p>
                                    </div>
                                </div>
                                <div class="policy-item">
                                    <div class="policy-icon">
                                        <i class="fas fa-undo-alt"></i>
                                    </div>
                                    <div class="policy-content">
                                        <h4>Ch√≠nh s√°ch ho√†n ti·ªÅn</h4>
                                        <p>Ch·ªâ √°p d·ª•ng khi h·ªá th·ªëng ch∆∞a x·ª≠ l√Ω ƒë∆°n.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                container.appendChild(productCard);
            });
        }

        function updateCustomExchange(productId, value) {
            const product = products.find(p => p.id === productId);
            if (!product || !product.isCustom) return;
            
            const amount = parseInt(value);
            const returnAmount = amount * systemConfig.exchangeRate;
            
            document.getElementById(`customAmountDisplay${productId}`).textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById(`customInput${productId}`).value = amount;
            document.getElementById(`customReturnDisplay${productId}`).textContent = formatCurrency(returnAmount) + 'ƒë';
            
            // Update product price for later use
            product.price = amount;
            product.returnAmount = returnAmount;
        }

        function updateCustomExchangeFromInput(productId, value) {
            const product = products.find(p => p.id === productId);
            if (!product || !product.isCustom) return;
            
            let amount = parseInt(value);
            
            // Validate range
            if (amount < product.minAmount) amount = product.minAmount;
            if (amount > product.maxAmount) amount = product.maxAmount;
            
            const returnAmount = amount * systemConfig.exchangeRate;
            
            document.getElementById(`customAmountDisplay${productId}`).textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById(`customInput${productId}`).value = amount;
            document.getElementById(`customReturnDisplay${productId}`).textContent = formatCurrency(returnAmount) + 'ƒë';
            
            // Update slider
            const slider = document.querySelector(`#customInput${productId}`).previousElementSibling.querySelector('.investment-slider');
            if (slider) slider.value = amount;
            
            // Update product price for later use
            product.price = amount;
            product.returnAmount = returnAmount;
        }

        function viewProductDetail(productId) {
            if (!currentUser) {
                navigateTo('loginPage');
                return;
            }
            
            currentProduct = products.find(p => p.id === productId);
            if (!currentProduct) return;
            
            // Navigate to product detail page
            navigateTo('productDetail');
            
            // Hide login prompt, show content
            document.getElementById('productDetailLoginPrompt').style.display = 'none';
            document.getElementById('productDetailContent').style.display = 'flex';
            
            // Load product details
            const container = document.getElementById('productDetailContent');
            
            if (currentProduct.isCustom) {
                container.innerHTML = `
                    <div class="product-image-large">
                        <i class="fas ${currentProduct.icon}"></i>
                    </div>
                    <div class="product-details">
                        <h1>${currentProduct.name}</h1>
                        <p class="product-description">${currentProduct.description}</p>
                        
                        <div style="margin: 30px 0;">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">Ch·ªçn s·ªë ti·ªÅn g·ª≠i:</h3>
                            <div class="investment-slider-container">
                                <div class="investment-amount">
                                    <span>S·ªë ti·ªÅn g·ª≠i:</span>
                                    <span id="detailCustomAmountDisplay">${formatCurrency(currentProduct.price)}ƒë</span>
                                </div>
                                <input type="range" 
                                       class="investment-slider" 
                                       min="${currentProduct.minAmount}" 
                                       max="${currentProduct.maxAmount}" 
                                       step="100000" 
                                       value="${currentProduct.price}"
                                       oninput="updateDetailCustomExchange(this.value)">
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <input type="number" 
                                       class="investment-input" 
                                       id="detailCustomInput" 
                                       min="${currentProduct.minAmount}" 
                                       max="${currentProduct.maxAmount}"
                                       value="${currentProduct.price}"
                                       oninput="updateDetailCustomExchangeFromInput(this.value)"
                                       placeholder="Nh·∫≠p s·ªë ti·ªÅn g·ª≠i">
                            </div>
                            
                            <div style="background: rgba(0, 168, 89, 0.1); padding: 20px; border-radius: var(--border-radius); margin: 25px 0;">
                                <h4 style="color: var(--green-fortune); margin-bottom: 10px;">K·∫øt qu·∫£ ƒë·ªïi ti·ªÅn:</h4>
                                <div style="display: flex; justify-content: space-between; font-size: 20px;">
                                    <div>
                                        <div style="font-size: 14px; color: var(--light-text-secondary);">S·ªë ti·ªÅn g·ª≠i</div>
                                        <div style="color: var(--red-fortune); font-weight: 700;" id="detailExchangeAmount">${formatCurrency(currentProduct.price)}ƒë</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 14px; color: var(--light-text-secondary);">T·ª∑ l·ªá</div>
                                        <div style="color: var(--primary-color); font-weight: 700;">1:${systemConfig.exchangeRate}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 14px; color: var(--light-text-secondary);">S·ªë ti·ªÅn nh·∫≠n</div>
                                        <div style="color: var(--green-fortune); font-weight: 700;" id="detailReturnAmount">${formatCurrency(currentProduct.returnAmount)}ƒë</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="product-policies" style="margin: 40px 0;">
                            <h3 style="color: var(--primary-color); margin-bottom: 20px;">üìã CH√çNH S√ÅCH GIAO D·ªäCH</h3>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-money-check-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>1. Ch√≠nh s√°ch thanh to√°n</h4>
                                    <p>Kh√°ch h√†ng ph·∫£i thanh to√°n ƒë√∫ng s·ªë ti·ªÅn v√† ƒë√∫ng n·ªôi dung chuy·ªÉn kho·∫£n. Thanh to√°n s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n trong v√≤ng ${systemConfig.processingTime} ph√∫t sau khi h·ªá th·ªëng ghi nh·∫≠n giao d·ªãch. N·∫øu thanh to√°n sai n·ªôi dung, ƒë∆°n h√†ng c√≥ th·ªÉ b·ªã ch·∫≠m x·ª≠ l√Ω.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>2. Ch√≠nh s√°ch b·∫£o m·∫≠t</h4>
                                    <p>Ch√∫ng t√¥i kh√¥ng l∆∞u tr·ªØ th√¥ng tin c√° nh√¢n t√†i kho·∫£n v√† ho√†n to√†n b·∫£o m·∫≠t kh√°ch h√†ng. M·ªçi giao d·ªãch ƒë∆∞·ª£c b·∫£o m·∫≠t theo ti√™u chu·∫©n hi·ªán h√†nh. Kh√°ch h√†ng ph·∫£i t·ª± b·∫£o v·ªá th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa m√¨nh.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-undo-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>3. Ch√≠nh s√°ch ho√†n ti·ªÅn</h4>
                                    <p>Ho√†n ti·ªÅn ch·ªâ √°p d·ª•ng khi h·ªá th·ªëng ch∆∞a x·ª≠ l√Ω ƒë∆°n. Kh√¥ng h·ªó tr·ª£ ho√†n ti·ªÅn cho c√°c giao d·ªãch ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng. Khi ho√†n ti·ªÅn, h·ªá th·ªëng ho√†n tr·∫£ v·ªÅ ƒë√∫ng t√†i kho·∫£n ƒë√£ thanh to√°n.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-headset"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>4. Ch√≠nh s√°ch h·ªó tr·ª£</h4>
                                    <p>M·ªçi th√¥ng tin chi ti·∫øt ho·∫∑c t∆∞ v·∫•n h√£y nh·∫•p v√†o m·ª•c li√™n h·ªá b√™n tr√™n.</p>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-order" onclick="proceedToPayment()" style="padding: 18px 40px; font-size: 20px;">
                            <i class="fas fa-exchange-alt"></i> ƒê·ªîI NGAY
                        </button>
                        <p style="margin-top: 20px; color: var(--warning-color);">
                            <i class="fas fa-bolt"></i> ∆Øu ƒë√£i c√≥ h·∫°n, ƒë·ªïi ti·ªÅn ngay ƒë·ªÉ nh·∫≠n l·ª£i nhu·∫≠n cao nh·∫•t!
                        </p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="product-image-large">
                        <i class="fas ${currentProduct.icon}"></i>
                    </div>
                    <div class="product-details">
                        <h1>${currentProduct.name}</h1>
                        <p class="product-description">${currentProduct.description}</p>
                        
                        <div style="background: rgba(0, 168, 89, 0.1); padding: 25px; border-radius: var(--border-radius); margin: 30px 0;">
                            <h3 style="color: var(--green-fortune); margin-bottom: 15px;">Chi ti·∫øt ƒë·ªïi ti·ªÅn:</h3>
                            <div style="display: flex; justify-content: space-between; font-size: 22px;">
                                <div>
                                    <div style="font-size: 16px; color: var(--light-text-secondary);">S·ªë ti·ªÅn g·ª≠i</div>
                                    <div style="color: var(--red-fortune); font-weight: 700;">${formatCurrency(currentProduct.price)}ƒë</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 16px; color: var(--light-text-secondary);">T·ª∑ l·ªá ƒë·ªïi</div>
                                    <div style="color: var(--primary-color); font-weight: 700;">1:${systemConfig.exchangeRate}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 16px; color: var(--light-text-secondary);">S·ªë ti·ªÅn nh·∫≠n</div>
                                    <div style="color: var(--green-fortune); font-weight: 700;">${formatCurrency(currentProduct.returnAmount)}ƒë</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="product-policies" style="margin: 40px 0;">
                            <h3 style="color: var(--primary-color); margin-bottom: 20px;">üìã CH√çNH S√ÅCH GIAO D·ªäCH</h3>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-money-check-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>1. Ch√≠nh s√°ch thanh to√°n</h4>
                                    <p>Kh√°ch h√†ng ph·∫£i thanh to√°n ƒë√∫ng s·ªë ti·ªÅn v√† ƒë√∫ng n·ªôi dung chuy·ªÉn kho·∫£n. Thanh to√°n s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n trong v√≤ng ${systemConfig.processingTime} ph√∫t sau khi h·ªá th·ªëng ghi nh·∫≠n giao d·ªãch. N·∫øu thanh to√°n sai n·ªôi dung, ƒë∆°n h√†ng c√≥ th·ªÉ b·ªã ch·∫≠m x·ª≠ l√Ω.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>2. Ch√≠nh s√°ch b·∫£o m·∫≠t</h4>
                                    <p>Ch√∫ng t√¥i kh√¥ng l∆∞u tr·ªØ th√¥ng tin c√° nh√¢n t√†i kho·∫£n v√† ho√†n to√†n b·∫£o m·∫≠t kh√°ch h√†ng. M·ªçi giao d·ªãch ƒë∆∞·ª£c b·∫£o m·∫≠t theo ti√™u chu·∫©n hi·ªán h√†nh. Kh√°ch h√†ng ph·∫£i t·ª± b·∫£o v·ªá th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa m√¨nh.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-undo-alt"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>3. Ch√≠nh s√°ch ho√†n ti·ªÅn</h4>
                                    <p>Ho√†n ti·ªÅn ch·ªâ √°p d·ª•ng khi h·ªá th·ªëng ch∆∞a x·ª≠ l√Ω ƒë∆°n. Kh√¥ng h·ªó tr·ª£ ho√†n ti·ªÅn cho c√°c giao d·ªãch ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng. Khi ho√†n ti·ªÅn, h·ªá th·ªëng ho√†n tr·∫£ v·ªÅ ƒë√∫ng t√†i kho·∫£n ƒë√£ thanh to√°n.</p>
                                </div>
                            </div>
                            <div class="policy-item">
                                <div class="policy-icon">
                                    <i class="fas fa-headset"></i>
                                </div>
                                <div class="policy-content">
                                    <h4>4. Ch√≠nh s√°ch h·ªó tr·ª£</h4>
                                    <p>M·ªçi th√¥ng tin chi ti·∫øt ho·∫∑c t∆∞ v·∫•n h√£y nh·∫•p v√†o m·ª•c li√™n h·ªá b√™n tr√™n.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="price-tag">G·ª≠i: ${formatCurrency(currentProduct.price)}ƒë</div>
                        <button class="btn btn-order" onclick="proceedToPayment()" style="padding: 18px 40px; font-size: 20px;">
                            <i class="fas fa-exchange-alt"></i> ƒê·ªîI NGAY
                        </button>
                        <p style="margin-top: 20px; color: var(--warning-color);">
                            <i class="fas fa-bolt"></i> ∆Øu ƒë√£i c√≥ h·∫°n, ƒë·ªïi ti·ªÅn ngay ƒë·ªÉ nh·∫≠n l·ª£i nhu·∫≠n cao nh·∫•t!
                        </p>
                    </div>
                `;
            }
        }

        function updateDetailCustomExchange(value) {
            if (!currentProduct || !currentProduct.isCustom) return;
            
            const amount = parseInt(value);
            const returnAmount = amount * systemConfig.exchangeRate;
            
            document.getElementById('detailCustomAmountDisplay').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('detailCustomInput').value = amount;
            document.getElementById('detailExchangeAmount').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('detailReturnAmount').textContent = formatCurrency(returnAmount) + 'ƒë';
            
            // Update product price for later use
            currentProduct.price = amount;
            currentProduct.returnAmount = returnAmount;
        }

        function updateDetailCustomExchangeFromInput(value) {
            if (!currentProduct || !currentProduct.isCustom) return;
            
            let amount = parseInt(value);
            
            // Validate range
            if (amount < currentProduct.minAmount) amount = currentProduct.minAmount;
            if (amount > currentProduct.maxAmount) amount = currentProduct.maxAmount;
            
            const returnAmount = amount * systemConfig.exchangeRate;
            
            document.getElementById('detailCustomAmountDisplay').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('detailCustomInput').value = amount;
            document.getElementById('detailExchangeAmount').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('detailReturnAmount').textContent = formatCurrency(returnAmount) + 'ƒë';
            
            // Update slider
            const slider = document.querySelector('.investment-slider');
            if (slider) slider.value = amount;
            
            // Update product price for later use
            currentProduct.price = amount;
            currentProduct.returnAmount = returnAmount;
        }

        // ==================== PAYMENT FUNCTIONS ====================
        function proceedToPayment() {
            if (!currentProduct) return;
            
            if (!currentUser) {
                navigateTo('loginPage');
                return;
            }
            
            // Check balance
            if (currentUserData.balance < currentProduct.price) {
                showNotification(`S·ªë d∆∞ kh√¥ng ƒë·ªß! B·∫°n c√≤n ${formatCurrency(currentUserData.balance)}ƒë. Vui l√≤ng n·∫°p th√™m ti·ªÅn.`, 'warning');
                navigateTo('account');
                return;
            }
            
            // Generate a random order ID
            const orderId = 'EXC' + Date.now().toString().substr(-8);
            currentOrderId = orderId;
            
            // Navigate to payment page
            navigateTo('payment');
            
            // Hide login prompt, show content
            document.getElementById('paymentLoginPrompt').style.display = 'none';
            document.getElementById('paymentContent').style.display = 'block';
            
            // Update payment page
            document.getElementById('paymentProductName').textContent = currentProduct.name;
            document.getElementById('paymentQuantity').textContent = formatCurrency(currentProduct.price) + 'ƒë';
            document.getElementById('paymentReturn').textContent = formatCurrency(currentProduct.returnAmount) + 'ƒë';
            document.getElementById('bankAmount').textContent = formatCurrency(currentProduct.price) + 'ƒë';
            document.getElementById('bankContent').textContent = `EXC${orderId}`;
        }

        function confirmPayment() {
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        async function processPayment() {
            closeModal();
            
            if (!currentProduct || !currentOrderId) return;
            
            showLoader();
            
            try {
                // Create transaction record
                const transactionId = currentOrderId;
                const transactionData = {
                    id: transactionId,
                    type: 'exchange',
                    productId: currentProduct.id,
                    productName: currentProduct.name,
                    amount: currentProduct.price,
                    returnAmount: currentProduct.returnAmount,
                    date: new Date().toLocaleDateString('vi-VN'),
                    time: new Date().toLocaleTimeString('vi-VN'),
                    status: 'pending',
                    description: `ƒê·ªïi ti·ªÅn g√≥i ${currentProduct.name}`,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Update user balance and add transaction
                const newBalance = currentUserData.balance - currentProduct.price;
                
                await db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance,
                    transactions: firebase.firestore.FieldValue.arrayUnion(transactionData),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Reload user data
                await loadUserData(currentUser.uid);
                
                showNotification(`ƒê√£ t·∫°o giao d·ªãch ${transactionId}! Vui l√≤ng ch·ªù x√°c nh·∫≠n.`, 'success');
                navigateTo('account');
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói x·ª≠ l√Ω thanh to√°n: ' + error.message, 'error');
            }
        }

        // ==================== DEPOSIT FUNCTIONS ====================
        async function confirmDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            
            if (!amount || amount < systemConfig.minDeposit) {
                showNotification(`S·ªë ti·ªÅn n·∫°p t·ªëi thi·ªÉu l√† ${formatCurrency(systemConfig.minDeposit)}ƒë!`, 'warning');
                return;
            }

            if (amount > 1000000000) {
                showNotification('S·ªë ti·ªÅn n·∫°p t·ªëi ƒëa l√† 1,000,000,000ƒë!', 'warning');
                return;
            }

            document.getElementById('depositModalAmount').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('depositModal').style.display = 'flex';
        }

        function closeDepositModal() {
            document.getElementById('depositModal').style.display = 'none';
        }

        async function processDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            closeDepositModal();
            
            showLoader();
            try {
                const transactionId = 'DEP' + Date.now().toString().substr(-8);
                
                const depositData = {
                    id: transactionId,
                    type: 'deposit',
                    amount: amount,
                    date: new Date().toLocaleDateString('vi-VN'),
                    time: new Date().toLocaleTimeString('vi-VN'),
                    status: 'pending',
                    description: 'N·∫°p ti·ªÅn v√†o t√†i kho·∫£n',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Th√™m giao d·ªãch v√†o l·ªãch s·ª≠
                await db.collection('users').doc(currentUser.uid).update({
                    transactions: firebase.firestore.FieldValue.arrayUnion(depositData),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Clear input
                document.getElementById('depositAmount').value = '';
                
                showNotification(`ƒê√£ g·ª≠i y√™u c·∫ßu n·∫°p ${formatCurrency(amount)}ƒë! Vui l√≤ng ch·ªù x√°c nh·∫≠n.`, 'success');
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói x·ª≠ l√Ω n·∫°p ti·ªÅn: ' + error.message, 'error');
            }
        }

        // ==================== WITHDRAW FUNCTIONS ====================
        async function confirmWithdraw() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bankName = document.getElementById('withdrawBankName').value;
            const accountNumber = document.getElementById('withdrawAccountNumber').value;
            const accountName = document.getElementById('withdrawAccountName').value;
            
            if (!amount || amount < systemConfig.minWithdraw) {
                showNotification(`S·ªë ti·ªÅn r√∫t t·ªëi thi·ªÉu l√† ${formatCurrency(systemConfig.minWithdraw)}ƒë!`, 'warning');
                return;
            }
            
            if (amount > currentUserData.balance) {
                showNotification(`S·ªë d∆∞ kh√¥ng ƒë·ªß! B·∫°n ch·ªâ c√≥ ${formatCurrency(currentUserData.balance)}ƒë`, 'warning');
                return;
            }
            
            if (!bankName || !accountNumber || !accountName) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ng√¢n h√†ng!', 'warning');
                return;
            }
            
            document.getElementById('withdrawModalAmount').textContent = formatCurrency(amount) + 'ƒë';
            document.getElementById('withdrawModalBank').textContent = bankName;
            document.getElementById('withdrawModalAccount').textContent = accountNumber;
            document.getElementById('withdrawModalName').textContent = accountName;
            document.getElementById('withdrawModal').style.display = 'flex';
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'none';
        }

        async function processWithdraw() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bankName = document.getElementById('withdrawBankName').value;
            const accountNumber = document.getElementById('withdrawAccountNumber').value;
            const accountName = document.getElementById('withdrawAccountName').value;
            
            closeWithdrawModal();
            
            showLoader();
            try {
                const transactionId = 'WIT' + Date.now().toString().substr(-8);
                
                const withdrawData = {
                    id: transactionId,
                    type: 'withdraw',
                    amount: amount,
                    bankName: bankName,
                    accountNumber: accountNumber,
                    accountName: accountName,
                    date: new Date().toLocaleDateString('vi-VN'),
                    time: new Date().toLocaleTimeString('vi-VN'),
                    status: 'pending',
                    description: 'R√∫t ti·ªÅn v·ªÅ t√†i kho·∫£n ng√¢n h√†ng',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Th√™m giao d·ªãch v√†o l·ªãch s·ª≠
                await db.collection('users').doc(currentUser.uid).update({
                    transactions: firebase.firestore.FieldValue.arrayUnion(withdrawData),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Clear inputs
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawBankName').value = '';
                document.getElementById('withdrawAccountNumber').value = '';
                document.getElementById('withdrawAccountName').value = '';
                
                showNotification(`ƒê√£ g·ª≠i y√™u c·∫ßu r√∫t ${formatCurrency(amount)}ƒë! Vui l√≤ng ch·ªù x√°c nh·∫≠n.`, 'success');
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói x·ª≠ l√Ω r√∫t ti·ªÅn: ' + error.message, 'error');
            }
        }

        // ==================== USER TRANSACTIONS FUNCTIONS ====================
        function loadUserTransactions() {
            if (!currentUserData || !currentUserData.transactions) return;
            
            const transactions = currentUserData.transactions || [];
            
            // Sort by date (newest first)
            transactions.sort((a, b) => {
                if (b.createdAt && a.createdAt) {
                    return b.createdAt.toDate() - a.createdAt.toDate();
                }
                return 0;
            });
            
            // Separate transactions by status
            const pending = transactions.filter(t => t.status === 'pending');
            const completed = transactions.filter(t => t.status === 'completed');
            
            // Update UI
            updateTransactionTable('history', transactions);
            updateTransactionTable('pending', pending);
            updateTransactionTable('completed', completed);
        }

        function updateTransactionTable(type, transactions) {
            const tableBody = document.getElementById(`account${type.charAt(0).toUpperCase() + type.slice(1)}Body`);
            const table = document.getElementById(`account${type.charAt(0).toUpperCase() + type.slice(1)}Table`);
            const noDataMessage = document.getElementById(`no${type.charAt(0).toUpperCase() + type.slice(1)}Message`);
            
            if (!tableBody || !table || !noDataMessage) return;
            
            if (transactions.length === 0) {
                table.style.display = 'none';
                noDataMessage.style.display = 'block';
                return;
            }
            
            table.style.display = 'table';
            noDataMessage.style.display = 'none';
            
            tableBody.innerHTML = '';
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                const statusClass = transaction.status === 'completed' ? 'status-completed' : 
                                   transaction.status === 'processing' ? 'status-pending' : 'status-pending';
                const statusText = transaction.status === 'completed' ? 'ƒê√£ ho√†n th√†nh' : 
                                  transaction.status === 'processing' ? 'ƒêang x·ª≠ l√Ω' : 'ƒêang ch·ªù';
                
                let rowContent = '';
                if (type === 'completed') {
                    rowContent = `
                        <td><strong>${transaction.id}</strong></td>
                        <td>${getTransactionTypeText(transaction.type)}</td>
                        <td><strong style="color: var(--red-fortune);">${formatCurrency(transaction.amount)}ƒë</strong></td>
                        <td>${transaction.date} ${transaction.time || ''}</td>
                        <td>${transaction.completedDate || transaction.date}</td>
                    `;
                } else {
                    rowContent = `
                        <td><strong>${transaction.id}</strong></td>
                        <td>${getTransactionTypeText(transaction.type)}</td>
                        <td><strong style="color: var(--red-fortune);">${formatCurrency(transaction.amount)}ƒë</strong></td>
                        <td>${transaction.date} ${transaction.time || ''}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                    `;
                }
                
                row.innerHTML = rowContent;
                tableBody.appendChild(row);
            });
        }

        function getTransactionTypeText(type) {
            switch(type) {
                case 'exchange': return 'ƒê·ªïi ti·ªÅn';
                case 'deposit': return 'N·∫°p ti·ªÅn';
                case 'withdraw': return 'R√∫t ti·ªÅn';
                default: return type;
            }
        }

        // ==================== ACCOUNT NAVIGATION ====================
        function showAccountSection(sectionId) {
            // Update active menu
            document.querySelectorAll('.account-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('.history-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show selected section
            const section = document.getElementById(sectionId + 'Section');
            section.classList.add('active');
            section.style.display = 'block';
        }

        // ==================== ADMIN FUNCTIONS ====================
        async function loadAdminData() {
            if (!currentUserData || currentUserData.role !== 'admin') {
                document.getElementById('adminLoginPrompt').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
                return;
            }
            
            document.getElementById('adminLoginPrompt').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            
            showLoader();
            try {
                // Load all users
                const usersSnapshot = await db.collection('users').get();
                const users = [];
                let totalDeposits = 0;
                let pendingTransactions = 0;
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    users.push({ id: doc.id, ...userData });
                    
                    // Calculate statistics
                    if (userData.transactions) {
                        userData.transactions.forEach(transaction => {
                            if (transaction.type === 'deposit' && transaction.status === 'completed') {
                                totalDeposits += transaction.amount;
                            }
                            if (transaction.status === 'pending') {
                                pendingTransactions++;
                            }
                        });
                    }
                });
                
                // Update stats
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('totalDeposits').textContent = formatCurrency(totalDeposits) + 'ƒë';
                document.getElementById('pendingTransactions').textContent = pendingTransactions;
                document.getElementById('dailyRevenue').textContent = formatCurrency(totalDeposits * 0.1) + 'ƒë'; // Example calculation
                
                // Render users
                renderAdminUsers(users);
                
                // Load pending transactions
                loadAdminTransactions(users);
                
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói t·∫£i d·ªØ li·ªáu admin: ' + error.message, 'error');
            }
        }

        function renderAdminUsers(users) {
            const container = document.getElementById('usersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--light-text-secondary);">Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o</p>';
                return;
            }
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                
                const badgeClass = user.role === 'admin' ? 'admin' : 
                                  user.role === 'vip' ? 'vip' : 'user';
                
                userItem.innerHTML = `
                    <div class="user-info-admin">
                        <div class="user-avatar-admin">${user.avatar}</div>
                        <div class="user-details">
                            <h4>${user.fullName || user.username}</h4>
                            <p>${user.email}</p>
                            <p>S·ªë d∆∞: <strong>${formatCurrency(user.balance || 0)}ƒë</strong> ‚Ä¢ Giao d·ªãch: ${user.transactions ? user.transactions.length : 0}</p>
                        </div>
                    </div>
                    <div class="user-actions">
                        <span class="badge ${badgeClass}">${user.role === 'admin' ? 'Qu·∫£n tr·ªã' : user.role === 'vip' ? 'VIP' : 'Ng∆∞·ªùi d√πng'}</span>
                        <button class="btn" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn" style="background: var(--gradient-red); color: white;" onclick="deleteUser('${user.id}', '${user.fullName || user.username}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(userItem);
            });
        }

        async function loadAdminTransactions(users) {
            const container = document.getElementById('adminTransactionsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Collect all pending transactions
            const pendingTransactions = [];
            
            users.forEach(user => {
                if (user.transactions) {
                    user.transactions.forEach(transaction => {
                        if (transaction.status === 'pending') {
                            pendingTransactions.push({
                                ...transaction,
                                userId: user.id,
                                userName: user.fullName || user.username,
                                userEmail: user.email
                            });
                        }
                    });
                }
            });
            
            if (pendingTransactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--light-text-secondary); padding: 20px;">Kh√¥ng c√≥ giao d·ªãch ch·ªù x·ª≠ l√Ω</p>';
                return;
            }
            
            // Sort by date (oldest first)
            pendingTransactions.sort((a, b) => {
                if (a.createdAt && b.createdAt) {
                    return a.createdAt.toDate() - b.createdAt.toDate();
                }
                return 0;
            });
            
            // Display transactions
            pendingTransactions.forEach(transaction => {
                const transactionItem = document.createElement('div');
                transactionItem.className = 'order-item';
                
                const typeText = getTransactionTypeText(transaction.type);
                const typeColor = transaction.type === 'deposit' ? 'var(--green-fortune)' : 
                                 transaction.type === 'withdraw' ? 'var(--red-fortune)' : 'var(--primary-color)';
                
                transactionItem.innerHTML = `
                    <div>
                        <h4 style="color: ${typeColor};">${typeText} ‚Ä¢ ${transaction.id}</h4>
                        <p><strong>${transaction.userName}</strong> (${transaction.userEmail})</p>
                        <p>S·ªë ti·ªÅn: <strong>${formatCurrency(transaction.amount)}ƒë</strong> ‚Ä¢ Ng√†y: ${transaction.date} ${transaction.time || ''}</p>
                        ${transaction.description ? `<p>${transaction.description}</p>` : ''}
                        ${transaction.bankName ? `<p>Ng√¢n h√†ng: ${transaction.bankName} - ${transaction.accountNumber} - ${transaction.accountName}</p>` : ''}
                    </div>
                    <div class="order-actions">
                        <button class="btn btn-primary" onclick="processAdminTransaction('${transaction.userId}', '${transaction.id}')">
                            <i class="fas fa-cog"></i> X·ª≠ l√Ω
                        </button>
                    </div>
                `;
                
                container.appendChild(transactionItem);
            });
        }

        function searchUsers() {
            const searchTerm = document.getElementById('adminSearch').value.toLowerCase();
            // Implementation would filter users based on search term
            // This is a simplified version
            console.log('Searching for:', searchTerm);
        }

        function refreshAdminData() {
            loadAdminData();
        }

        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
        }

        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        async function createNewUser() {
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            const balance = parseInt(document.getElementById('newUserBalance').value) || 0;

            if (!name || !email || !password) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'warning');
                return;
            }

            if (password.length < 6) {
                showNotification('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!', 'warning');
                return;
            }

            showLoader();
            try {
                // Create user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Update display name
                await user.updateProfile({
                    displayName: name
                });

                // Create user data in Firestore
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    username: user.email.split('@')[0],
                    fullName: name,
                    phone: '',
                    balance: balance,
                    avatar: getInitials(name),
                    joinDate: new Date().toLocaleDateString('vi-VN'),
                    transactions: [],
                    totalDeposit: 0,
                    totalWithdraw: 0,
                    role: role,
                    isActive: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(user.uid).set(userData);
                
                closeAddUserModal();
                showNotification('T·∫°o ng∆∞·ªùi d√πng th√†nh c√¥ng!', 'success');
                loadAdminData();
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói t·∫°o ng∆∞·ªùi d√πng: ' + error.message, 'error');
            }
        }

        async function editUser(userId) {
            showLoader();
            try {
                const doc = await db.collection('users').doc(userId).get();
                if (doc.exists) {
                    const userData = doc.data();
                    
                    document.getElementById('editUserId').value = userId;
                    document.getElementById('editUserName').value = userData.fullName || '';
                    document.getElementById('editUserEmail').value = userData.email;
                    document.getElementById('editUserPhone').value = userData.phone || '';
                    document.getElementById('editUserBalance').value = userData.balance || 0;
                    document.getElementById('editUserRole').value = userData.role || 'user';
                    
                    document.getElementById('editUserModal').style.display = 'flex';
                }
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói t·∫£i th√¥ng tin ng∆∞·ªùi d√πng: ' + error.message, 'error');
            }
        }

        function closeEditUserModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }

        async function saveUserChanges() {
            const userId = document.getElementById('editUserId').value;
            const name = document.getElementById('editUserName').value;
            const phone = document.getElementById('editUserPhone').value;
            const balance = parseInt(document.getElementById('editUserBalance').value) || 0;
            const role = document.getElementById('editUserRole').value;

            if (!name) {
                showNotification('Vui l√≤ng nh·∫≠p h·ªç v√† t√™n!', 'warning');
                return;
            }

            showLoader();
            try {
                const updates = {
                    fullName: name,
                    phone: phone,
                    balance: balance,
                    role: role,
                    avatar: getInitials(name),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(userId).update(updates);
                
                closeEditUserModal();
                showNotification('C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng th√†nh c√¥ng!', 'success');
                loadAdminData();
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói c·∫≠p nh·∫≠t ng∆∞·ªùi d√πng: ' + error.message, 'error');
            }
        }

        async function deleteUser(userId, userName) {
            if (!confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng "${userName}"?`)) {
                return;
            }

            showLoader();
            try {
                // Delete from Firestore
                await db.collection('users').doc(userId).delete();
                
                // Note: In a real app, you might also want to delete from Firebase Auth
                // This requires admin privileges or the user's password
                
                showNotification(`ƒê√£ x√≥a ng∆∞·ªùi d√πng "${userName}"`, 'success');
                loadAdminData();
                hideLoader();
            } catch (error) {
                hideLoader();
                showNotification('L·ªói x√≥a ng∆∞·ªùi d√πng: ' + error.message, 'error');
            }
        }

        function showSystemConfig() {
            document.getElementById('configExchangeRate').value = systemConfig.exchangeRate;
            document.getElementById('configMinDeposit').value = systemConfig.minDeposit;
            document.getElementById('configMinWithdraw').value = systemConfig.minWithdraw;
            document.getElementById('configProcessingTime').value = systemConfig.processingTime;
            document.getElementById('configMaxTransactions').value = systemConfig.maxTransactionsPerWeek;
            
            document.getElementById('systemConfigModal').style.display = 'flex';
        }

        function closeSystemConfigModal() {
            document.getElementById('systemConfigModal').style.display = 'none';
        }

        async function saveSystemConfig() {
            const exchangeRate = parseInt(document.getElementById('configExchangeRate').value);
            const minDeposit = parseInt(document.getElementById('configMinDeposit').value);
            const minWithdraw = parseInt(document.getElementById('configMinWithdraw').value);
            const processingTime = parseInt(document.getElementById('configProcessingTime').value);
            const maxTransactions = parseInt(document.getElementById('configMaxTransactions').value);

            systemConfig = {
                exchangeRate: exchangeRate,
                minDeposit: minDeposit,
                minWithdraw: minWithdraw,
                processingTime: processingTime,
                maxTransactionsPerWeek: maxTransactions
            };

            try {
                // Save to Firestore
                await db.collection('config').doc('system').set(systemConfig);
                
                closeSystemConfigModal();
                showNotification('ƒê√£ l∆∞u c·∫•u h√¨nh h·ªá th·ªëng!', 'success');
                
                // Reload products to update exchange rate
                loadProducts();
            } catch (error) {
                showNotification('L·ªói l∆∞u c·∫•u h√¨nh: ' + error.message, 'error');
            }
        }

        async function loadSystemConfig() {
            try {
                const doc = await db.collection('config').doc('system').get();
                if (doc.exists) {
                    systemConfig = doc.data();
                }
            } catch (error) {
                console.log('Using default system config');
            }
        }

        function processAdminTransaction(userId, transactionId) {
            // This would open a modal to process the transaction
            // For now, just show a message
            showNotification(`X·ª≠ l√Ω giao d·ªãch ${transactionId} c·ªßa ng∆∞·ªùi d√πng ${userId}`, 'info');
            
            // In a real implementation, you would:
            // 1. Load transaction details
            // 2. Show a modal with options (approve, reject, etc.)
            // 3. Update transaction status and user balance accordingly
        }

        // ==================== UTILITY FUNCTIONS ====================
        function updateUIForLoggedInUser() {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            
            // Show product detail and payment pages if user is logged in
            if (document.querySelector('.page.active').id === 'productDetail') {
                document.getElementById('productDetailLoginPrompt').style.display = 'none';
                document.getElementById('productDetailContent').style.display = 'flex';
            }
            
            if (document.querySelector('.page.active').id === 'payment') {
                document.getElementById('paymentLoginPrompt').style.display = 'none';
                document.getElementById('paymentContent').style.display = 'block';
            }
            
            if (document.querySelector('.page.active').id === 'account') {
                document.getElementById('accountLoginPrompt').style.display = 'none';
                document.getElementById('accountContent').style.display = 'grid';
            }
            
            // Check if admin
            if (currentUserData && currentUserData.role === 'admin' && document.querySelector('.page.active').id === 'admin') {
                loadAdminData();
            }
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('loginBtn').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'none';
            
            // Update home page
            document.getElementById('balanceMessage').textContent = 'ƒêƒÉng nh·∫≠p ƒë·ªÉ xem s·ªë d∆∞';
            document.getElementById('homeButtons').style.display = 'none';
            document.getElementById('loginPrompt').style.display = 'block';
            
            // Hide account content
            document.getElementById('accountLoginPrompt').style.display = 'block';
            document.getElementById('accountContent').style.display = 'none';
            
            // Hide admin content
            document.getElementById('adminLoginPrompt').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }

        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
        }

        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function handleAuthError(error) {
            let message = '';
            switch (error.code) {
                case 'auth/email-already-in-use':
                    message = 'Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!';
                    break;
                case 'auth/invalid-email':
                    message = 'Email kh√¥ng h·ª£p l·ªá!';
                    break;
                case 'auth/weak-password':
                    message = 'M·∫≠t kh·∫©u qu√° y·∫øu!';
                    break;
                case 'auth/user-not-found':
                    message = 'T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!';
                    break;
                case 'auth/wrong-password':
                    message = 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!';
                    break;
                case 'auth/too-many-requests':
                    message = 'Qu√° nhi·ªÅu l·∫ßn th·ª≠. Vui l√≤ng th·ª≠ l·∫°i sau!';
                    break;
                default:
                    message = 'L·ªói: ' + error.message;
            }
            showNotification(message, 'error');
        }

        function formatCurrency(amount) {
            if (!amount) return '0';
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // ==================== NAVIGATION FUNCTIONS ====================
        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Navigation links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    navigateTo(pageId);
                });
            });
            
            // User info click
            document.getElementById('userInfo').addEventListener('click', function() {
                navigateTo('account');
            });
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const icon = document.getElementById('themeToggle').querySelector('i');
            if (isDarkMode) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        function navigateTo(pageId) {
            // Don't navigate if already on the page
            const currentPage = document.querySelector('.page.active');
            if (currentPage && currentPage.id === pageId) return;
            
            // Add fade-out effect
            const mainContent = document.getElementById('mainContent');
            mainContent.classList.add('fade-out');
            
            // Wait for animation then change page
            setTimeout(() => {
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Show target page
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                    
                    // Handle specific pages
                    if (pageId === 'products' || pageId === 'home') {
                        const containerId = pageId === 'products' ? 'productsGrid' : 'homeProducts';
                        renderProducts(containerId);
                    } else if (pageId === 'account' && currentUser) {
                        loadUserTransactions();
                    } else if (pageId === 'admin' && currentUserData && currentUserData.role === 'admin') {
                        loadAdminData();
                    }
                }
                
                // Remove fade-out effect
                setTimeout(() => {
                    mainContent.classList.remove('fade-out');
                }, 50);
                
                // Update URL hash
                window.location.hash = pageId;
            }, 300);
        }

        // Handle hash changes
        window.addEventListener('hashchange', function() {
            const pageId = window.location.hash.substring(1) || 'home';
            navigateTo(pageId);
        });

        // Initial navigation based on hash
        const initialPage = window.location.hash.substring(1) || 'home';
        navigateTo(initialPage);
    </script>
</body>
</html>